var $t=Object.create;var Ut=Object.defineProperty;var Kt=Object.getOwnPropertyDescriptor;var Wt=Object.getOwnPropertyNames;var Xt=Object.getPrototypeOf,Zt=Object.prototype.hasOwnProperty;var at=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var Jt=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Wt(e))!Zt.call(t,n)&&n!==i&&Ut(t,n,{get:()=>e[n],enumerable:!(r=Kt(e,n))||r.enumerable});return t};var G=(t,e,i)=>(i=t!=null?$t(Xt(t)):{},Jt(e||!t||!t.__esModule?Ut(i,"default",{value:t,enumerable:!0}):i,t));var At=at(S=>{var p=function(){var t=new Date,e=4,i=3,r=2,n=1,a=e,o={setLogLevel:function(h){h==this.debug?a=n:h==this.info?a=r:h==this.warn?a=i:(h==this.error,a=e)},debug:function(h,f){console.debug===void 0&&(console.debug=console.log),n>=a&&console.debug("["+p.getDurationString(new Date-t,1e3)+"]","["+h+"]",f)},log:function(h,f){this.debug(h.msg)},info:function(h,f){r>=a&&console.info("["+p.getDurationString(new Date-t,1e3)+"]","["+h+"]",f)},warn:function(h,f){i>=a&&console.warn("["+p.getDurationString(new Date-t,1e3)+"]","["+h+"]",f)},error:function(h,f){e>=a&&console.error("["+p.getDurationString(new Date-t,1e3)+"]","["+h+"]",f)}};return o}();p.getDurationString=function(t,e){var i;function r(d,u){for(var y=""+d,g=y.split(".");g[0].length<u;)g[0]="0"+g[0];return g.join(".")}t<0?(i=!0,t=-t):i=!1;var n=e||1,a=t/n,o=Math.floor(a/3600);a-=o*3600;var h=Math.floor(a/60);a-=h*60;var f=a*1e3;return a=Math.floor(a),f-=a*1e3,f=Math.floor(f),(i?"-":"")+o+":"+r(h,2)+":"+r(a,2)+"."+r(f,3)};p.printRanges=function(t){var e=t.length;if(e>0){for(var i="",r=0;r<e;r++)r>0&&(i+=","),i+="["+p.getDurationString(t.start(r))+","+p.getDurationString(t.end(r))+"]";return i}else return"(empty)"};typeof S<"u"&&(S.Log=p);var x=function(t){if(t instanceof ArrayBuffer)this.buffer=t,this.dataview=new DataView(t);else throw"Needs an array buffer";this.position=0};x.prototype.getPosition=function(){return this.position};x.prototype.getEndPosition=function(){return this.buffer.byteLength};x.prototype.getLength=function(){return this.buffer.byteLength};x.prototype.seek=function(t){var e=Math.max(0,Math.min(this.buffer.byteLength,t));return this.position=isNaN(e)||!isFinite(e)?0:e,!0};x.prototype.isEos=function(){return this.getPosition()>=this.getEndPosition()};x.prototype.readAnyInt=function(t,e){var i=0;if(this.position+t<=this.buffer.byteLength){switch(t){case 1:e?i=this.dataview.getInt8(this.position):i=this.dataview.getUint8(this.position);break;case 2:e?i=this.dataview.getInt16(this.position):i=this.dataview.getUint16(this.position);break;case 3:if(e)throw"No method for reading signed 24 bits values";i=this.dataview.getUint8(this.position)<<16,i|=this.dataview.getUint8(this.position+1)<<8,i|=this.dataview.getUint8(this.position+2);break;case 4:e?i=this.dataview.getInt32(this.position):i=this.dataview.getUint32(this.position);break;case 8:if(e)throw"No method for reading signed 64 bits values";i=this.dataview.getUint32(this.position)<<32,i|=this.dataview.getUint32(this.position+4);break;default:throw"readInt method not implemented for size: "+t}return this.position+=t,i}else throw"Not enough bytes in buffer"};x.prototype.readUint8=function(){return this.readAnyInt(1,!1)};x.prototype.readUint16=function(){return this.readAnyInt(2,!1)};x.prototype.readUint24=function(){return this.readAnyInt(3,!1)};x.prototype.readUint32=function(){return this.readAnyInt(4,!1)};x.prototype.readUint64=function(){return this.readAnyInt(8,!1)};x.prototype.readString=function(t){if(this.position+t<=this.buffer.byteLength){for(var e="",i=0;i<t;i++)e+=String.fromCharCode(this.readUint8());return e}else throw"Not enough bytes in buffer"};x.prototype.readCString=function(){for(var t=[];;){var e=this.readUint8();if(e!==0)t.push(e);else break}return String.fromCharCode.apply(null,t)};x.prototype.readInt8=function(){return this.readAnyInt(1,!0)};x.prototype.readInt16=function(){return this.readAnyInt(2,!0)};x.prototype.readInt32=function(){return this.readAnyInt(4,!0)};x.prototype.readInt64=function(){return this.readAnyInt(8,!1)};x.prototype.readUint8Array=function(t){for(var e=new Uint8Array(t),i=0;i<t;i++)e[i]=this.readUint8();return e};x.prototype.readInt16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readInt16();return e};x.prototype.readUint16Array=function(t){for(var e=new Int16Array(t),i=0;i<t;i++)e[i]=this.readUint16();return e};x.prototype.readUint32Array=function(t){for(var e=new Uint32Array(t),i=0;i<t;i++)e[i]=this.readUint32();return e};x.prototype.readInt32Array=function(t){for(var e=new Int32Array(t),i=0;i<t;i++)e[i]=this.readInt32();return e};typeof S<"u"&&(S.MP4BoxStream=x);var l=function(t,e,i){this._byteOffset=e||0,t instanceof ArrayBuffer?this.buffer=t:typeof t=="object"?(this.dataView=t,e&&(this._byteOffset+=e)):this.buffer=new ArrayBuffer(t||0),this.position=0,this.endianness=i??l.LITTLE_ENDIAN};l.prototype={};l.prototype.getPosition=function(){return this.position};l.prototype._realloc=function(t){if(this._dynamicSize){var e=this._byteOffset+this.position+t,i=this._buffer.byteLength;if(e<=i){e>this._byteLength&&(this._byteLength=e);return}for(i<1&&(i=1);e>i;)i*=2;var r=new ArrayBuffer(i),n=new Uint8Array(this._buffer),a=new Uint8Array(r,0,n.length);a.set(n),this.buffer=r,this._byteLength=e}};l.prototype._trimAlloc=function(){if(this._byteLength!=this._buffer.byteLength){var t=new ArrayBuffer(this._byteLength),e=new Uint8Array(t),i=new Uint8Array(this._buffer,0,e.length);e.set(i),this.buffer=t}};l.BIG_ENDIAN=!1;l.LITTLE_ENDIAN=!0;l.prototype._byteLength=0;Object.defineProperty(l.prototype,"byteLength",{get:function(){return this._byteLength-this._byteOffset}});Object.defineProperty(l.prototype,"buffer",{get:function(){return this._trimAlloc(),this._buffer},set:function(t){this._buffer=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}});Object.defineProperty(l.prototype,"byteOffset",{get:function(){return this._byteOffset},set:function(t){this._byteOffset=t,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._buffer.byteLength}});Object.defineProperty(l.prototype,"dataView",{get:function(){return this._dataView},set:function(t){this._byteOffset=t.byteOffset,this._buffer=t.buffer,this._dataView=new DataView(this._buffer,this._byteOffset),this._byteLength=this._byteOffset+t.byteLength}});l.prototype.seek=function(t){var e=Math.max(0,Math.min(this.byteLength,t));this.position=isNaN(e)||!isFinite(e)?0:e};l.prototype.isEof=function(){return this.position>=this._byteLength};l.prototype.mapUint8Array=function(t){this._realloc(t*1);var e=new Uint8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e};l.prototype.readInt32Array=function(t,e){t=t??this.byteLength-this.position/4;var i=new Int32Array(t);return l.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),l.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i};l.prototype.readInt16Array=function(t,e){t=t??this.byteLength-this.position/2;var i=new Int16Array(t);return l.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),l.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i};l.prototype.readInt8Array=function(t){t=t??this.byteLength-this.position;var e=new Int8Array(t);return l.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e};l.prototype.readUint32Array=function(t,e){t=t??this.byteLength-this.position/4;var i=new Uint32Array(t);return l.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),l.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i};l.prototype.readUint16Array=function(t,e){t=t??this.byteLength-this.position/2;var i=new Uint16Array(t);return l.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),l.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i};l.prototype.readUint8Array=function(t){t=t??this.byteLength-this.position;var e=new Uint8Array(t);return l.memcpy(e.buffer,0,this.buffer,this.byteOffset+this.position,t*e.BYTES_PER_ELEMENT),this.position+=e.byteLength,e};l.prototype.readFloat64Array=function(t,e){t=t??this.byteLength-this.position/8;var i=new Float64Array(t);return l.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),l.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i};l.prototype.readFloat32Array=function(t,e){t=t??this.byteLength-this.position/4;var i=new Float32Array(t);return l.memcpy(i.buffer,0,this.buffer,this.byteOffset+this.position,t*i.BYTES_PER_ELEMENT),l.arrayToNative(i,e??this.endianness),this.position+=i.byteLength,i};l.prototype.readInt32=function(t){var e=this._dataView.getInt32(this.position,t??this.endianness);return this.position+=4,e};l.prototype.readInt16=function(t){var e=this._dataView.getInt16(this.position,t??this.endianness);return this.position+=2,e};l.prototype.readInt8=function(){var t=this._dataView.getInt8(this.position);return this.position+=1,t};l.prototype.readUint32=function(t){var e=this._dataView.getUint32(this.position,t??this.endianness);return this.position+=4,e};l.prototype.readUint16=function(t){var e=this._dataView.getUint16(this.position,t??this.endianness);return this.position+=2,e};l.prototype.readUint8=function(){var t=this._dataView.getUint8(this.position);return this.position+=1,t};l.prototype.readFloat32=function(t){var e=this._dataView.getFloat32(this.position,t??this.endianness);return this.position+=4,e};l.prototype.readFloat64=function(t){var e=this._dataView.getFloat64(this.position,t??this.endianness);return this.position+=8,e};l.endianness=new Int8Array(new Int16Array([1]).buffer)[0]>0;l.memcpy=function(t,e,i,r,n){var a=new Uint8Array(t,e,n),o=new Uint8Array(i,r,n);a.set(o)};l.arrayToNative=function(t,e){return e==this.endianness?t:this.flipArrayEndianness(t)};l.nativeToEndian=function(t,e){return this.endianness==e?t:this.flipArrayEndianness(t)};l.flipArrayEndianness=function(t){for(var e=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=0;i<t.byteLength;i+=t.BYTES_PER_ELEMENT)for(var r=i+t.BYTES_PER_ELEMENT-1,n=i;r>n;r--,n++){var a=e[n];e[n]=e[r],e[r]=a}return t};l.prototype.failurePosition=0;String.fromCharCodeUint8=function(t){for(var e=[],i=0;i<t.length;i++)e[i]=t[i];return String.fromCharCode.apply(null,e)};l.prototype.readString=function(t,e){return e==null||e=="ASCII"?String.fromCharCodeUint8.apply(null,[this.mapUint8Array(t??this.byteLength-this.position)]):new TextDecoder(e).decode(this.mapUint8Array(t))};l.prototype.readCString=function(t){var e=this.byteLength-this.position,i=new Uint8Array(this._buffer,this._byteOffset+this.position),r=e;t!=null&&(r=Math.min(t,e));for(var n=0;n<r&&i[n]!==0;n++);var a=String.fromCharCodeUint8.apply(null,[this.mapUint8Array(n)]);return t!=null?this.position+=r-n:n!=e&&(this.position+=1),a};var k=Math.pow(2,32);l.prototype.readInt64=function(){return this.readInt32()*k+this.readUint32()};l.prototype.readUint64=function(){return this.readUint32()*k+this.readUint32()};l.prototype.readInt64=function(){return this.readUint32()*k+this.readUint32()};l.prototype.readUint24=function(){return(this.readUint8()<<16)+(this.readUint8()<<8)+this.readUint8()};typeof S<"u"&&(S.DataStream=l);l.prototype.save=function(t){var e=new Blob([this.buffer]);if(window.URL&&URL.createObjectURL){var i=window.URL.createObjectURL(e),r=document.createElement("a");document.body.appendChild(r),r.setAttribute("href",i),r.setAttribute("download",t),r.setAttribute("target","_self"),r.click(),window.URL.revokeObjectURL(i)}else throw"DataStream.save: Can't create object URL."};l.prototype._dynamicSize=!0;Object.defineProperty(l.prototype,"dynamicSize",{get:function(){return this._dynamicSize},set:function(t){t||this._trimAlloc(),this._dynamicSize=t}});l.prototype.shift=function(t){var e=new ArrayBuffer(this._byteLength-t),i=new Uint8Array(e),r=new Uint8Array(this._buffer,t,i.length);i.set(r),this.buffer=e,this.position-=t};l.prototype.writeInt32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Int32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)l.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt32(t[i],e)};l.prototype.writeInt16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Int16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)l.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeInt16(t[i],e)};l.prototype.writeInt8Array=function(t){if(this._realloc(t.length*1),t instanceof Int8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)l.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapInt8Array(t.length);else for(var e=0;e<t.length;e++)this.writeInt8(t[e])};l.prototype.writeUint32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Uint32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)l.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint32(t[i],e)};l.prototype.writeUint16Array=function(t,e){if(this._realloc(t.length*2),t instanceof Uint16Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)l.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint16Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeUint16(t[i],e)};l.prototype.writeUint8Array=function(t){if(this._realloc(t.length*1),t instanceof Uint8Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)l.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapUint8Array(t.length);else for(var e=0;e<t.length;e++)this.writeUint8(t[e])};l.prototype.writeFloat64Array=function(t,e){if(this._realloc(t.length*8),t instanceof Float64Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)l.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat64Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat64(t[i],e)};l.prototype.writeFloat32Array=function(t,e){if(this._realloc(t.length*4),t instanceof Float32Array&&this.byteOffset+this.position%t.BYTES_PER_ELEMENT===0)l.memcpy(this._buffer,this.byteOffset+this.position,t.buffer,0,t.byteLength),this.mapFloat32Array(t.length,e);else for(var i=0;i<t.length;i++)this.writeFloat32(t[i],e)};l.prototype.writeInt32=function(t,e){this._realloc(4),this._dataView.setInt32(this.position,t,e??this.endianness),this.position+=4};l.prototype.writeInt16=function(t,e){this._realloc(2),this._dataView.setInt16(this.position,t,e??this.endianness),this.position+=2};l.prototype.writeInt8=function(t){this._realloc(1),this._dataView.setInt8(this.position,t),this.position+=1};l.prototype.writeUint32=function(t,e){this._realloc(4),this._dataView.setUint32(this.position,t,e??this.endianness),this.position+=4};l.prototype.writeUint16=function(t,e){this._realloc(2),this._dataView.setUint16(this.position,t,e??this.endianness),this.position+=2};l.prototype.writeUint8=function(t){this._realloc(1),this._dataView.setUint8(this.position,t),this.position+=1};l.prototype.writeFloat32=function(t,e){this._realloc(4),this._dataView.setFloat32(this.position,t,e??this.endianness),this.position+=4};l.prototype.writeFloat64=function(t,e){this._realloc(8),this._dataView.setFloat64(this.position,t,e??this.endianness),this.position+=8};l.prototype.writeUCS2String=function(t,e,i){i==null&&(i=t.length);for(var r=0;r<t.length&&r<i;r++)this.writeUint16(t.charCodeAt(r),e);for(;r<i;r++)this.writeUint16(0)};l.prototype.writeString=function(t,e,i){var r=0;if(e==null||e=="ASCII")if(i!=null){var n=Math.min(t.length,i);for(r=0;r<n;r++)this.writeUint8(t.charCodeAt(r));for(;r<i;r++)this.writeUint8(0)}else for(r=0;r<t.length;r++)this.writeUint8(t.charCodeAt(r));else this.writeUint8Array(new TextEncoder(e).encode(t.substring(0,i)))};l.prototype.writeCString=function(t,e){var i=0;if(e!=null){var r=Math.min(t.length,e);for(i=0;i<r;i++)this.writeUint8(t.charCodeAt(i));for(;i<e;i++)this.writeUint8(0)}else{for(i=0;i<t.length;i++)this.writeUint8(t.charCodeAt(i));this.writeUint8(0)}};l.prototype.writeStruct=function(t,e){for(var i=0;i<t.length;i+=2){var r=t[i+1];this.writeType(r,e[t[i]],e)}};l.prototype.writeType=function(t,e,i){var r;if(typeof t=="function")return t(this,e);if(typeof t=="object"&&!(t instanceof Array))return t.set(this,e,i);var n=null,a="ASCII",o=this.position;switch(typeof t=="string"&&/:/.test(t)&&(r=t.split(":"),t=r[0],n=parseInt(r[1])),typeof t=="string"&&/,/.test(t)&&(r=t.split(","),t=r[0],a=parseInt(r[1])),t){case"uint8":this.writeUint8(e);break;case"int8":this.writeInt8(e);break;case"uint16":this.writeUint16(e,this.endianness);break;case"int16":this.writeInt16(e,this.endianness);break;case"uint32":this.writeUint32(e,this.endianness);break;case"int32":this.writeInt32(e,this.endianness);break;case"float32":this.writeFloat32(e,this.endianness);break;case"float64":this.writeFloat64(e,this.endianness);break;case"uint16be":this.writeUint16(e,l.BIG_ENDIAN);break;case"int16be":this.writeInt16(e,l.BIG_ENDIAN);break;case"uint32be":this.writeUint32(e,l.BIG_ENDIAN);break;case"int32be":this.writeInt32(e,l.BIG_ENDIAN);break;case"float32be":this.writeFloat32(e,l.BIG_ENDIAN);break;case"float64be":this.writeFloat64(e,l.BIG_ENDIAN);break;case"uint16le":this.writeUint16(e,l.LITTLE_ENDIAN);break;case"int16le":this.writeInt16(e,l.LITTLE_ENDIAN);break;case"uint32le":this.writeUint32(e,l.LITTLE_ENDIAN);break;case"int32le":this.writeInt32(e,l.LITTLE_ENDIAN);break;case"float32le":this.writeFloat32(e,l.LITTLE_ENDIAN);break;case"float64le":this.writeFloat64(e,l.LITTLE_ENDIAN);break;case"cstring":this.writeCString(e,n);break;case"string":this.writeString(e,a,n);break;case"u16string":this.writeUCS2String(e,this.endianness,n);break;case"u16stringle":this.writeUCS2String(e,l.LITTLE_ENDIAN,n);break;case"u16stringbe":this.writeUCS2String(e,l.BIG_ENDIAN,n);break;default:if(t.length==3){for(var h=t[1],f=0;f<e.length;f++)this.writeType(h,e[f]);break}else{this.writeStruct(t,e);break}}n!=null&&(this.position=o,this._realloc(n),this.position=o+n)};l.prototype.writeUint64=function(t){var e=Math.floor(t/k);this.writeUint32(e),this.writeUint32(t&4294967295)};l.prototype.writeUint24=function(t){this.writeUint8((t&16711680)>>16),this.writeUint8((t&65280)>>8),this.writeUint8(t&255)};l.prototype.adjustUint32=function(t,e){var i=this.position;this.seek(t),this.writeUint32(e),this.seek(i)};l.prototype.mapInt32Array=function(t,e){this._realloc(t*4);var i=new Int32Array(this._buffer,this.byteOffset+this.position,t);return l.arrayToNative(i,e??this.endianness),this.position+=t*4,i};l.prototype.mapInt16Array=function(t,e){this._realloc(t*2);var i=new Int16Array(this._buffer,this.byteOffset+this.position,t);return l.arrayToNative(i,e??this.endianness),this.position+=t*2,i};l.prototype.mapInt8Array=function(t){this._realloc(t*1);var e=new Int8Array(this._buffer,this.byteOffset+this.position,t);return this.position+=t*1,e};l.prototype.mapUint32Array=function(t,e){this._realloc(t*4);var i=new Uint32Array(this._buffer,this.byteOffset+this.position,t);return l.arrayToNative(i,e??this.endianness),this.position+=t*4,i};l.prototype.mapUint16Array=function(t,e){this._realloc(t*2);var i=new Uint16Array(this._buffer,this.byteOffset+this.position,t);return l.arrayToNative(i,e??this.endianness),this.position+=t*2,i};l.prototype.mapFloat64Array=function(t,e){this._realloc(t*8);var i=new Float64Array(this._buffer,this.byteOffset+this.position,t);return l.arrayToNative(i,e??this.endianness),this.position+=t*8,i};l.prototype.mapFloat32Array=function(t,e){this._realloc(t*4);var i=new Float32Array(this._buffer,this.byteOffset+this.position,t);return l.arrayToNative(i,e??this.endianness),this.position+=t*4,i};var w=function(t){this.buffers=[],this.bufferIndex=-1,t&&(this.insertBuffer(t),this.bufferIndex=0)};w.prototype=new l(new ArrayBuffer,0,l.BIG_ENDIAN);w.prototype.initialized=function(){var t;return this.bufferIndex>-1?!0:this.buffers.length>0?(t=this.buffers[0],t.fileStart===0?(this.buffer=t,this.bufferIndex=0,p.debug("MultiBufferStream","Stream ready for parsing"),!0):(p.warn("MultiBufferStream","The first buffer should have a fileStart of 0"),this.logBufferLevel(),!1)):(p.warn("MultiBufferStream","No buffer to start parsing from"),this.logBufferLevel(),!1)};ArrayBuffer.concat=function(t,e){p.debug("ArrayBuffer","Trying to create a new buffer of size: "+(t.byteLength+e.byteLength));var i=new Uint8Array(t.byteLength+e.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(e),t.byteLength),i.buffer};w.prototype.reduceBuffer=function(t,e,i){var r;return r=new Uint8Array(i),r.set(new Uint8Array(t,e,i)),r.buffer.fileStart=t.fileStart+e,r.buffer.usedBytes=0,r.buffer};w.prototype.insertBuffer=function(t){for(var e=!0,i=0;i<this.buffers.length;i++){var r=this.buffers[i];if(t.fileStart<=r.fileStart){if(t.fileStart===r.fileStart)if(t.byteLength>r.byteLength){this.buffers.splice(i,1),i--;continue}else p.warn("MultiBufferStream","Buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+") already appended, ignoring");else t.fileStart+t.byteLength<=r.fileStart||(t=this.reduceBuffer(t,0,r.fileStart-t.fileStart)),p.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.splice(i,0,t),i===0&&(this.buffer=t);e=!1;break}else if(t.fileStart<r.fileStart+r.byteLength){var n=r.fileStart+r.byteLength-t.fileStart,a=t.byteLength-n;if(a>0)t=this.reduceBuffer(t,n,a);else{e=!1;break}}}e&&(p.debug("MultiBufferStream","Appending new buffer (fileStart: "+t.fileStart+" - Length: "+t.byteLength+")"),this.buffers.push(t),i===0&&(this.buffer=t))};w.prototype.logBufferLevel=function(t){var e,i,r,n,a=[],o,h="";for(r=0,n=0,e=0;e<this.buffers.length;e++)i=this.buffers[e],e===0?(o={},a.push(o),o.start=i.fileStart,o.end=i.fileStart+i.byteLength,h+="["+o.start+"-"):o.end===i.fileStart?o.end=i.fileStart+i.byteLength:(o={},o.start=i.fileStart,h+=a[a.length-1].end-1+"], ["+o.start+"-",o.end=i.fileStart+i.byteLength,a.push(o)),r+=i.usedBytes,n+=i.byteLength;a.length>0&&(h+=o.end-1+"]");var f=t?p.info:p.debug;this.buffers.length===0?f("MultiBufferStream","No more buffer in memory"):f("MultiBufferStream",""+this.buffers.length+" stored buffer(s) ("+r+"/"+n+" bytes), continuous ranges: "+h)};w.prototype.cleanBuffers=function(){var t,e;for(t=0;t<this.buffers.length;t++)e=this.buffers[t],e.usedBytes===e.byteLength&&(p.debug("MultiBufferStream","Removing buffer #"+t),this.buffers.splice(t,1),t--)};w.prototype.mergeNextBuffer=function(){var t;if(this.bufferIndex+1<this.buffers.length)if(t=this.buffers[this.bufferIndex+1],t.fileStart===this.buffer.fileStart+this.buffer.byteLength){var e=this.buffer.byteLength,i=this.buffer.usedBytes,r=this.buffer.fileStart;return this.buffers[this.bufferIndex]=ArrayBuffer.concat(this.buffer,t),this.buffer=this.buffers[this.bufferIndex],this.buffers.splice(this.bufferIndex+1,1),this.buffer.usedBytes=i,this.buffer.fileStart=r,p.debug("ISOFile","Concatenating buffer for box parsing (length: "+e+"->"+this.buffer.byteLength+")"),!0}else return!1;else return!1};w.prototype.findPosition=function(t,e,i){var r,n=null,a=-1;for(t===!0?r=0:r=this.bufferIndex;r<this.buffers.length&&(n=this.buffers[r],n.fileStart<=e);){a=r,i&&(n.fileStart+n.byteLength<=e?n.usedBytes=n.byteLength:n.usedBytes=e-n.fileStart,this.logBufferLevel());r++}return a!==-1?(n=this.buffers[a],n.fileStart+n.byteLength>=e?(p.debug("MultiBufferStream","Found position in existing buffer #"+a),a):-1):-1};w.prototype.findEndContiguousBuf=function(t){var e,i,r,n=t!==void 0?t:this.bufferIndex;if(i=this.buffers[n],this.buffers.length>n+1)for(e=n+1;e<this.buffers.length&&(r=this.buffers[e],r.fileStart===i.fileStart+i.byteLength);e++)i=r;return i.fileStart+i.byteLength};w.prototype.getEndFilePositionAfter=function(t){var e=this.findPosition(!0,t,!1);return e!==-1?this.findEndContiguousBuf(e):t};w.prototype.addUsedBytes=function(t){this.buffer.usedBytes+=t,this.logBufferLevel()};w.prototype.setAllUsedBytes=function(){this.buffer.usedBytes=this.buffer.byteLength,this.logBufferLevel()};w.prototype.seek=function(t,e,i){var r;return r=this.findPosition(e,t,i),r!==-1?(this.buffer=this.buffers[r],this.bufferIndex=r,this.position=t-this.buffer.fileStart,p.debug("MultiBufferStream","Repositioning parser at buffer position: "+this.position),!0):(p.debug("MultiBufferStream","Position "+t+" not found in buffered data"),!1)};w.prototype.getPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.position};w.prototype.getLength=function(){return this.byteLength};w.prototype.getEndPosition=function(){if(this.bufferIndex===-1||this.buffers[this.bufferIndex]===null)throw"Error accessing position in the MultiBufferStream";return this.buffers[this.bufferIndex].fileStart+this.byteLength};typeof S<"u"&&(S.MultiBufferStream=w);var ot=function(){var t=3,e=4,i=5,r=6,n=[];n[t]="ES_Descriptor",n[e]="DecoderConfigDescriptor",n[i]="DecoderSpecificInfo",n[r]="SLConfigDescriptor",this.getDescriptorName=function(h){return n[h]};var a=this,o={};return this.parseOneDescriptor=function(h){var f=0,d=0,u,y,g;for(u=h.readUint8(),f++,g=h.readUint8(),f++;g&128;)d=(g&127)<<7,g=h.readUint8(),f++;return d+=g&127,p.debug("MPEG4DescriptorParser","Found "+(n[u]||"Descriptor "+u)+", size "+d+" at position "+h.getPosition()),n[u]?y=new o[n[u]](d):y=new o.Descriptor(d),y.parse(h),y},o.Descriptor=function(h,f){this.tag=h,this.size=f,this.descs=[]},o.Descriptor.prototype.parse=function(h){this.data=h.readUint8Array(this.size)},o.Descriptor.prototype.findDescriptor=function(h){for(var f=0;f<this.descs.length;f++)if(this.descs[f].tag==h)return this.descs[f];return null},o.Descriptor.prototype.parseRemainingDescriptors=function(h){for(var f=h.position;h.position<f+this.size;){var d=a.parseOneDescriptor(h);this.descs.push(d)}},o.ES_Descriptor=function(h){o.Descriptor.call(this,t,h)},o.ES_Descriptor.prototype=new o.Descriptor,o.ES_Descriptor.prototype.parse=function(h){if(this.ES_ID=h.readUint16(),this.flags=h.readUint8(),this.size-=3,this.flags&128?(this.dependsOn_ES_ID=h.readUint16(),this.size-=2):this.dependsOn_ES_ID=0,this.flags&64){var f=h.readUint8();this.URL=h.readString(f),this.size-=f+1}else this.URL="";this.flags&32?(this.OCR_ES_ID=h.readUint16(),this.size-=2):this.OCR_ES_ID=0,this.parseRemainingDescriptors(h)},o.ES_Descriptor.prototype.getOTI=function(h){var f=this.findDescriptor(e);return f?f.oti:0},o.ES_Descriptor.prototype.getAudioConfig=function(h){var f=this.findDescriptor(e);if(!f)return null;var d=f.findDescriptor(i);if(d&&d.data){var u=(d.data[0]&248)>>3;return u===31&&d.data.length>=2&&(u=32+((d.data[0]&7)<<3)+((d.data[1]&224)>>5)),u}else return null},o.DecoderConfigDescriptor=function(h){o.Descriptor.call(this,e,h)},o.DecoderConfigDescriptor.prototype=new o.Descriptor,o.DecoderConfigDescriptor.prototype.parse=function(h){this.oti=h.readUint8(),this.streamType=h.readUint8(),this.bufferSize=h.readUint24(),this.maxBitrate=h.readUint32(),this.avgBitrate=h.readUint32(),this.size-=13,this.parseRemainingDescriptors(h)},o.DecoderSpecificInfo=function(h){o.Descriptor.call(this,i,h)},o.DecoderSpecificInfo.prototype=new o.Descriptor,o.SLConfigDescriptor=function(h){o.Descriptor.call(this,r,h)},o.SLConfigDescriptor.prototype=new o.Descriptor,this};typeof S<"u"&&(S.MPEG4DescriptorParser=ot);var s={ERR_INVALID_DATA:-1,ERR_NOT_ENOUGH_DATA:0,OK:1,BASIC_BOXES:["mdat","idat","free","skip","meco","strk"],FULL_BOXES:["hmhd","nmhd","iods","xml ","bxml","ipro","mere"],CONTAINER_BOXES:[["moov",["trak","pssh"]],["trak"],["edts"],["mdia"],["minf"],["dinf"],["stbl",["sgpd","sbgp"]],["mvex",["trex"]],["moof",["traf"]],["traf",["trun","sgpd","sbgp"]],["vttc"],["tref"],["iref"],["mfra",["tfra"]],["meco"],["hnti"],["hinf"],["strk"],["strd"],["sinf"],["rinf"],["schi"],["trgr"],["udta",["kind"]],["iprp",["ipma"]],["ipco"]],boxCodes:[],fullBoxCodes:[],containerBoxCodes:[],sampleEntryCodes:{},sampleGroupEntryCodes:[],trackGroupTypes:[],UUIDBoxes:{},UUIDs:[],initialize:function(){s.FullBox.prototype=new s.Box,s.ContainerBox.prototype=new s.Box,s.SampleEntry.prototype=new s.Box,s.TrackGroupTypeBox.prototype=new s.FullBox,s.BASIC_BOXES.forEach(function(t){s.createBoxCtor(t)}),s.FULL_BOXES.forEach(function(t){s.createFullBoxCtor(t)}),s.CONTAINER_BOXES.forEach(function(t){s.createContainerBoxCtor(t[0],null,t[1])})},Box:function(t,e,i){this.type=t,this.size=e,this.uuid=i},FullBox:function(t,e,i){s.Box.call(this,t,e,i),this.flags=0,this.version=0},ContainerBox:function(t,e,i){s.Box.call(this,t,e,i),this.boxes=[]},SampleEntry:function(t,e,i,r){s.ContainerBox.call(this,t,e),this.hdr_size=i,this.start=r},SampleGroupEntry:function(t){this.grouping_type=t},TrackGroupTypeBox:function(t,e){s.FullBox.call(this,t,e)},createBoxCtor:function(t,e){s.boxCodes.push(t),s[t+"Box"]=function(i){s.Box.call(this,t,i)},s[t+"Box"].prototype=new s.Box,e&&(s[t+"Box"].prototype.parse=e)},createFullBoxCtor:function(t,e){s[t+"Box"]=function(i){s.FullBox.call(this,t,i)},s[t+"Box"].prototype=new s.FullBox,s[t+"Box"].prototype.parse=function(i){this.parseFullHeader(i),e&&e.call(this,i)}},addSubBoxArrays:function(t){if(t){this.subBoxNames=t;for(var e=t.length,i=0;i<e;i++)this[t[i]+"s"]=[]}},createContainerBoxCtor:function(t,e,i){s[t+"Box"]=function(r){s.ContainerBox.call(this,t,r),s.addSubBoxArrays.call(this,i)},s[t+"Box"].prototype=new s.ContainerBox,e&&(s[t+"Box"].prototype.parse=e)},createMediaSampleEntryCtor:function(t,e,i){s.sampleEntryCodes[t]=[],s[t+"SampleEntry"]=function(r,n){s.SampleEntry.call(this,r,n),s.addSubBoxArrays.call(this,i)},s[t+"SampleEntry"].prototype=new s.SampleEntry,e&&(s[t+"SampleEntry"].prototype.parse=e)},createSampleEntryCtor:function(t,e,i,r){s.sampleEntryCodes[t].push(e),s[e+"SampleEntry"]=function(n){s[t+"SampleEntry"].call(this,e,n),s.addSubBoxArrays.call(this,r)},s[e+"SampleEntry"].prototype=new s[t+"SampleEntry"],i&&(s[e+"SampleEntry"].prototype.parse=i)},createEncryptedSampleEntryCtor:function(t,e,i){s.createSampleEntryCtor.call(this,t,e,i,["sinf"])},createSampleGroupCtor:function(t,e){s[t+"SampleGroupEntry"]=function(i){s.SampleGroupEntry.call(this,t,i)},s[t+"SampleGroupEntry"].prototype=new s.SampleGroupEntry,e&&(s[t+"SampleGroupEntry"].prototype.parse=e)},createTrackGroupCtor:function(t,e){s[t+"TrackGroupTypeBox"]=function(i){s.TrackGroupTypeBox.call(this,t,i)},s[t+"TrackGroupTypeBox"].prototype=new s.TrackGroupTypeBox,e&&(s[t+"TrackGroupTypeBox"].prototype.parse=e)},createUUIDBox:function(t,e,i,r){s.UUIDs.push(t),s.UUIDBoxes[t]=function(n){e?s.FullBox.call(this,"uuid",n,t):i?s.ContainerBox.call(this,"uuid",n,t):s.Box.call(this,"uuid",n,t)},s.UUIDBoxes[t].prototype=e?new s.FullBox:i?new s.ContainerBox:new s.Box,r&&(e?s.UUIDBoxes[t].prototype.parse=function(n){this.parseFullHeader(n),r&&r.call(this,n)}:s.UUIDBoxes[t].prototype.parse=r)}};s.initialize();s.TKHD_FLAG_ENABLED=1;s.TKHD_FLAG_IN_MOVIE=2;s.TKHD_FLAG_IN_PREVIEW=4;s.TFHD_FLAG_BASE_DATA_OFFSET=1;s.TFHD_FLAG_SAMPLE_DESC=2;s.TFHD_FLAG_SAMPLE_DUR=8;s.TFHD_FLAG_SAMPLE_SIZE=16;s.TFHD_FLAG_SAMPLE_FLAGS=32;s.TFHD_FLAG_DUR_EMPTY=65536;s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF=131072;s.TRUN_FLAGS_DATA_OFFSET=1;s.TRUN_FLAGS_FIRST_FLAG=4;s.TRUN_FLAGS_DURATION=256;s.TRUN_FLAGS_SIZE=512;s.TRUN_FLAGS_FLAGS=1024;s.TRUN_FLAGS_CTS_OFFSET=2048;s.Box.prototype.add=function(t){return this.addBox(new s[t+"Box"])};s.Box.prototype.addBox=function(t){return this.boxes.push(t),this[t.type+"s"]?this[t.type+"s"].push(t):this[t.type]=t,t};s.Box.prototype.set=function(t,e){return this[t]=e,this};s.Box.prototype.addEntry=function(t,e){var i=e||"entries";return this[i]||(this[i]=[]),this[i].push(t),this};typeof S<"u"&&(S.BoxParser=s);s.parseUUID=function(t){return s.parseHex16(t)};s.parseHex16=function(t){for(var e="",i=0;i<16;i++){var r=t.readUint8().toString(16);e+=r.length===1?"0"+r:r}return e};s.parseOneBox=function(t,e,i){var r,n=t.getPosition(),a=0,o,h;if(t.getEndPosition()-n<8)return p.debug("BoxParser","Not enough data in stream to parse the type and size of the box"),{code:s.ERR_NOT_ENOUGH_DATA};if(i&&i<8)return p.debug("BoxParser","Not enough bytes left in the parent box to parse a new box"),{code:s.ERR_NOT_ENOUGH_DATA};var f=t.readUint32(),d=t.readString(4),u=d;if(p.debug("BoxParser","Found box of type '"+d+"' and size "+f+" at position "+n),a=8,d=="uuid"){if(t.getEndPosition()-t.getPosition()<16||i-a<16)return t.seek(n),p.debug("BoxParser","Not enough bytes left in the parent box to parse a UUID box"),{code:s.ERR_NOT_ENOUGH_DATA};h=s.parseUUID(t),a+=16,u=h}if(f==1){if(t.getEndPosition()-t.getPosition()<8||i&&i-a<8)return t.seek(n),p.warn("BoxParser",'Not enough data in stream to parse the extended size of the "'+d+'" box'),{code:s.ERR_NOT_ENOUGH_DATA};f=t.readUint64(),a+=8}else if(f===0){if(i)f=i;else if(d!=="mdat")return p.error("BoxParser","Unlimited box size not supported for type: '"+d+"'"),r=new s.Box(d,f),{code:s.OK,box:r,size:r.size}}return f!==0&&f<a?(p.error("BoxParser","Box of type "+d+" has an invalid size "+f+" (too small to be a box)"),{code:s.ERR_NOT_ENOUGH_DATA,type:d,size:f,hdr_size:a,start:n}):f!==0&&i&&f>i?(p.error("BoxParser","Box of type '"+d+"' has a size "+f+" greater than its container size "+i),{code:s.ERR_NOT_ENOUGH_DATA,type:d,size:f,hdr_size:a,start:n}):f!==0&&n+f>t.getEndPosition()?(t.seek(n),p.info("BoxParser","Not enough data in stream to parse the entire '"+d+"' box"),{code:s.ERR_NOT_ENOUGH_DATA,type:d,size:f,hdr_size:a,start:n}):e?{code:s.OK,type:d,size:f,hdr_size:a,start:n}:(s[d+"Box"]?r=new s[d+"Box"](f):d!=="uuid"?(p.warn("BoxParser","Unknown box type: '"+d+"'"),r=new s.Box(d,f),r.has_unparsed_data=!0):s.UUIDBoxes[h]?r=new s.UUIDBoxes[h](f):(p.warn("BoxParser","Unknown uuid type: '"+h+"'"),r=new s.Box(d,f),r.uuid=h,r.has_unparsed_data=!0),r.hdr_size=a,r.start=n,r.write===s.Box.prototype.write&&r.type!=="mdat"&&(p.info("BoxParser","'"+u+"' box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),o=t.getPosition()-(r.start+r.size),o<0?(p.warn("BoxParser","Parsing of box '"+u+"' did not read the entire indicated box data size (missing "+-o+" bytes), seeking forward"),t.seek(r.start+r.size)):o>0&&(p.error("BoxParser","Parsing of box '"+u+"' read "+o+" more bytes than the indicated box data size, seeking backwards"),r.size!==0&&t.seek(r.start+r.size)),{code:s.OK,box:r,size:r.size})};s.Box.prototype.parse=function(t){this.type!="mdat"?this.data=t.readUint8Array(this.size-this.hdr_size):this.size===0?t.seek(t.getEndPosition()):t.seek(this.start+this.size)};s.Box.prototype.parseDataAndRewind=function(t){this.data=t.readUint8Array(this.size-this.hdr_size),t.position-=this.size-this.hdr_size};s.FullBox.prototype.parseDataAndRewind=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=4,t.position-=this.size-this.hdr_size};s.FullBox.prototype.parseFullHeader=function(t){this.version=t.readUint8(),this.flags=t.readUint24(),this.hdr_size+=4};s.FullBox.prototype.parse=function(t){this.parseFullHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)};s.ContainerBox.prototype.parse=function(t){for(var e,i;t.getPosition()<this.start+this.size;)if(e=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===s.OK)if(i=e.box,this.boxes.push(i),this.subBoxNames&&this.subBoxNames.indexOf(i.type)!=-1)this[this.subBoxNames[this.subBoxNames.indexOf(i.type)]+"s"].push(i);else{var r=i.type!=="uuid"?i.type:i.uuid;this[r]?p.warn("Box of type "+r+" already stored in field of this type"):this[r]=i}else return};s.Box.prototype.parseLanguage=function(t){this.language=t.readUint16();var e=[];e[0]=this.language>>10&31,e[1]=this.language>>5&31,e[2]=this.language&31,this.languageString=String.fromCharCode(e[0]+96,e[1]+96,e[2]+96)};s.SAMPLE_ENTRY_TYPE_VISUAL="Visual";s.SAMPLE_ENTRY_TYPE_AUDIO="Audio";s.SAMPLE_ENTRY_TYPE_HINT="Hint";s.SAMPLE_ENTRY_TYPE_METADATA="Metadata";s.SAMPLE_ENTRY_TYPE_SUBTITLE="Subtitle";s.SAMPLE_ENTRY_TYPE_SYSTEM="System";s.SAMPLE_ENTRY_TYPE_TEXT="Text";s.SampleEntry.prototype.parseHeader=function(t){t.readUint8Array(6),this.data_reference_index=t.readUint16(),this.hdr_size+=8};s.SampleEntry.prototype.parse=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size)};s.SampleEntry.prototype.parseDataAndRewind=function(t){this.parseHeader(t),this.data=t.readUint8Array(this.size-this.hdr_size),this.hdr_size-=8,t.position-=this.size-this.hdr_size};s.SampleEntry.prototype.parseFooter=function(t){s.ContainerBox.prototype.parse.call(this,t)};s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_HINT);s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA);s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE);s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SYSTEM);s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_TEXT);s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,function(t){var e;this.parseHeader(t),t.readUint16(),t.readUint16(),t.readUint32Array(3),this.width=t.readUint16(),this.height=t.readUint16(),this.horizresolution=t.readUint32(),this.vertresolution=t.readUint32(),t.readUint32(),this.frame_count=t.readUint16(),e=Math.min(31,t.readUint8()),this.compressorname=t.readString(e),e<31&&t.readString(31-e),this.depth=t.readUint16(),t.readUint16(),this.parseFooter(t)});s.createMediaSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,function(t){this.parseHeader(t),t.readUint32Array(2),this.channel_count=t.readUint16(),this.samplesize=t.readUint16(),t.readUint16(),t.readUint16(),this.samplerate=t.readUint32()/(1<<16),this.parseFooter(t)});s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc1");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc2");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc3");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"avc4");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"av01");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hvc1");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"hev1");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvc1");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvi1");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvs1");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vvcN");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vp08");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"vp09");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"mp4a");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ac-3");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"ec-3");s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"Opus");s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_VISUAL,"encv");s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_AUDIO,"enca");s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"encu");s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SYSTEM,"encs");s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_TEXT,"enct");s.createEncryptedSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"encm");s.createBoxCtor("a1lx",function(t){var e=t.readUint8()&1,i=((e&1)+1)*16;this.layer_size=[];for(var r=0;r<3;r++)i==16?this.layer_size[r]=t.readUint16():this.layer_size[r]=t.readUint32()});s.createBoxCtor("a1op",function(t){this.op_index=t.readUint8()});s.createFullBoxCtor("auxC",function(t){this.aux_type=t.readCString();var e=this.size-this.hdr_size-(this.aux_type.length+1);this.aux_subtype=t.readUint8Array(e)});s.createBoxCtor("av1C",function(t){var e,i,r=t.readUint8();if(r>>7&!1){p.error("av1C marker problem");return}if(this.version=r&127,this.version!==1){p.error("av1C version "+this.version+" not supported");return}if(r=t.readUint8(),this.seq_profile=r>>5&7,this.seq_level_idx_0=r&31,r=t.readUint8(),this.seq_tier_0=r>>7&1,this.high_bitdepth=r>>6&1,this.twelve_bit=r>>5&1,this.monochrome=r>>4&1,this.chroma_subsampling_x=r>>3&1,this.chroma_subsampling_y=r>>2&1,this.chroma_sample_position=r&3,r=t.readUint8(),this.reserved_1=r>>5&7,this.reserved_1!==0){p.error("av1C reserved_1 parsing problem");return}if(this.initial_presentation_delay_present=r>>4&1,this.initial_presentation_delay_present===1)this.initial_presentation_delay_minus_one=r&15;else if(this.reserved_2=r&15,this.reserved_2!==0){p.error("av1C reserved_2 parsing problem");return}var n=this.size-this.hdr_size-4;this.configOBUs=t.readUint8Array(n)});s.createBoxCtor("avcC",function(t){var e,i;for(this.configurationVersion=t.readUint8(),this.AVCProfileIndication=t.readUint8(),this.profile_compatibility=t.readUint8(),this.AVCLevelIndication=t.readUint8(),this.lengthSizeMinusOne=t.readUint8()&3,this.nb_SPS_nalus=t.readUint8()&31,i=this.size-this.hdr_size-6,this.SPS=[],e=0;e<this.nb_SPS_nalus;e++)this.SPS[e]={},this.SPS[e].length=t.readUint16(),this.SPS[e].nalu=t.readUint8Array(this.SPS[e].length),i-=2+this.SPS[e].length;for(this.nb_PPS_nalus=t.readUint8(),i--,this.PPS=[],e=0;e<this.nb_PPS_nalus;e++)this.PPS[e]={},this.PPS[e].length=t.readUint16(),this.PPS[e].nalu=t.readUint8Array(this.PPS[e].length),i-=2+this.PPS[e].length;i>0&&(this.ext=t.readUint8Array(i))});s.createBoxCtor("btrt",function(t){this.bufferSizeDB=t.readUint32(),this.maxBitrate=t.readUint32(),this.avgBitrate=t.readUint32()});s.createBoxCtor("clap",function(t){this.cleanApertureWidthN=t.readUint32(),this.cleanApertureWidthD=t.readUint32(),this.cleanApertureHeightN=t.readUint32(),this.cleanApertureHeightD=t.readUint32(),this.horizOffN=t.readUint32(),this.horizOffD=t.readUint32(),this.vertOffN=t.readUint32(),this.vertOffD=t.readUint32()});s.createBoxCtor("clli",function(t){this.max_content_light_level=t.readUint16(),this.max_pic_average_light_level=t.readUint16()});s.createFullBoxCtor("co64",function(t){var e,i;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(i=0;i<e;i++)this.chunk_offsets.push(t.readUint64())});s.createFullBoxCtor("CoLL",function(t){this.maxCLL=t.readUint16(),this.maxFALL=t.readUint16()});s.createBoxCtor("colr",function(t){if(this.colour_type=t.readString(4),this.colour_type==="nclx"){this.colour_primaries=t.readUint16(),this.transfer_characteristics=t.readUint16(),this.matrix_coefficients=t.readUint16();var e=t.readUint8();this.full_range_flag=e>>7}else this.colour_type==="rICC"?this.ICC_profile=t.readUint8Array(this.size-4):this.colour_type==="prof"&&(this.ICC_profile=t.readUint8Array(this.size-4))});s.createFullBoxCtor("cprt",function(t){this.parseLanguage(t),this.notice=t.readCString()});s.createFullBoxCtor("cslg",function(t){var e;this.version===0&&(this.compositionToDTSShift=t.readInt32(),this.leastDecodeToDisplayDelta=t.readInt32(),this.greatestDecodeToDisplayDelta=t.readInt32(),this.compositionStartTime=t.readInt32(),this.compositionEndTime=t.readInt32())});s.createFullBoxCtor("ctts",function(t){var e,i;if(e=t.readUint32(),this.sample_counts=[],this.sample_offsets=[],this.version===0)for(i=0;i<e;i++){this.sample_counts.push(t.readUint32());var r=t.readInt32();r<0&&p.warn("BoxParser","ctts box uses negative values without using version 1"),this.sample_offsets.push(r)}else if(this.version==1)for(i=0;i<e;i++)this.sample_counts.push(t.readUint32()),this.sample_offsets.push(t.readInt32())});s.createBoxCtor("dac3",function(t){var e=t.readUint8(),i=t.readUint8(),r=t.readUint8();this.fscod=e>>6,this.bsid=e>>1&31,this.bsmod=(e&1)<<2|i>>6&3,this.acmod=i>>3&7,this.lfeon=i>>2&1,this.bit_rate_code=i&3|r>>5&7});s.createBoxCtor("dec3",function(t){var e=t.readUint16();this.data_rate=e>>3,this.num_ind_sub=e&7,this.ind_subs=[];for(var i=0;i<this.num_ind_sub+1;i++){var r={};this.ind_subs.push(r);var n=t.readUint8(),a=t.readUint8(),o=t.readUint8();r.fscod=n>>6,r.bsid=n>>1&31,r.bsmod=(n&1)<<4|a>>4&15,r.acmod=a>>1&7,r.lfeon=a&1,r.num_dep_sub=o>>1&15,r.num_dep_sub>0&&(r.chan_loc=(o&1)<<8|t.readUint8())}});s.createFullBoxCtor("dfLa",function(t){var e=127,i=128,r=[],n=["STREAMINFO","PADDING","APPLICATION","SEEKTABLE","VORBIS_COMMENT","CUESHEET","PICTURE","RESERVED"];this.parseFullHeader(t);do{var a=t.readUint8(),o=Math.min(a&e,n.length-1);if(o?t.readUint8Array(t.readUint24()):(t.readUint8Array(13),this.samplerate=t.readUint32()>>12,t.readUint8Array(20)),r.push(n[o]),a&i)break}while(!0);this.numMetadataBlocks=r.length+" ("+r.join(", ")+")"});s.createBoxCtor("dimm",function(t){this.bytessent=t.readUint64()});s.createBoxCtor("dmax",function(t){this.time=t.readUint32()});s.createBoxCtor("dmed",function(t){this.bytessent=t.readUint64()});s.createBoxCtor("dOps",function(t){if(this.Version=t.readUint8(),this.OutputChannelCount=t.readUint8(),this.PreSkip=t.readUint16(),this.InputSampleRate=t.readUint32(),this.OutputGain=t.readInt16(),this.ChannelMappingFamily=t.readUint8(),this.ChannelMappingFamily!==0){this.StreamCount=t.readUint8(),this.CoupledCount=t.readUint8(),this.ChannelMapping=[];for(var e=0;e<this.OutputChannelCount;e++)this.ChannelMapping[e]=t.readUint8()}});s.createFullBoxCtor("dref",function(t){var e,i;this.entries=[];for(var r=t.readUint32(),n=0;n<r;n++)if(e=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===s.OK)i=e.box,this.entries.push(i);else return});s.createBoxCtor("drep",function(t){this.bytessent=t.readUint64()});s.createFullBoxCtor("elng",function(t){this.extended_language=t.readString(this.size-this.hdr_size)});s.createFullBoxCtor("elst",function(t){this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var r={};this.entries.push(r),this.version===1?(r.segment_duration=t.readUint64(),r.media_time=t.readInt64()):(r.segment_duration=t.readUint32(),r.media_time=t.readInt32()),r.media_rate_integer=t.readInt16(),r.media_rate_fraction=t.readInt16()}});s.createFullBoxCtor("emsg",function(t){this.version==1?(this.timescale=t.readUint32(),this.presentation_time=t.readUint64(),this.event_duration=t.readUint32(),this.id=t.readUint32(),this.scheme_id_uri=t.readCString(),this.value=t.readCString()):(this.scheme_id_uri=t.readCString(),this.value=t.readCString(),this.timescale=t.readUint32(),this.presentation_time_delta=t.readUint32(),this.event_duration=t.readUint32(),this.id=t.readUint32());var e=this.size-this.hdr_size-(4*4+(this.scheme_id_uri.length+1)+(this.value.length+1));this.version==1&&(e-=4),this.message_data=t.readUint8Array(e)});s.createFullBoxCtor("esds",function(t){var e=t.readUint8Array(this.size-this.hdr_size);if(typeof ot<"u"){var i=new ot;this.esd=i.parseOneDescriptor(new l(e.buffer,0,l.BIG_ENDIAN))}});s.createBoxCtor("fiel",function(t){this.fieldCount=t.readUint8(),this.fieldOrdering=t.readUint8()});s.createBoxCtor("frma",function(t){this.data_format=t.readString(4)});s.createBoxCtor("ftyp",function(t){var e=this.size-this.hdr_size;this.major_brand=t.readString(4),this.minor_version=t.readUint32(),e-=8,this.compatible_brands=[];for(var i=0;e>=4;)this.compatible_brands[i]=t.readString(4),e-=4,i++});s.createFullBoxCtor("hdlr",function(t){this.version===0&&(t.readUint32(),this.handler=t.readString(4),t.readUint32Array(3),this.name=t.readString(this.size-this.hdr_size-20),this.name[this.name.length-1]==="\0"&&(this.name=this.name.slice(0,-1)))});s.createBoxCtor("hvcC",function(t){var e,i,r,n,a;this.configurationVersion=t.readUint8(),a=t.readUint8(),this.general_profile_space=a>>6,this.general_tier_flag=(a&32)>>5,this.general_profile_idc=a&31,this.general_profile_compatibility=t.readUint32(),this.general_constraint_indicator=t.readUint8Array(6),this.general_level_idc=t.readUint8(),this.min_spatial_segmentation_idc=t.readUint16()&4095,this.parallelismType=t.readUint8()&3,this.chroma_format_idc=t.readUint8()&3,this.bit_depth_luma_minus8=t.readUint8()&7,this.bit_depth_chroma_minus8=t.readUint8()&7,this.avgFrameRate=t.readUint16(),a=t.readUint8(),this.constantFrameRate=a>>6,this.numTemporalLayers=(a&13)>>3,this.temporalIdNested=(a&4)>>2,this.lengthSizeMinusOne=a&3,this.nalu_arrays=[];var o=t.readUint8();for(e=0;e<o;e++){var h=[];this.nalu_arrays.push(h),a=t.readUint8(),h.completeness=(a&128)>>7,h.nalu_type=a&63;var f=t.readUint16();for(i=0;i<f;i++){var d={};h.push(d),n=t.readUint16(),d.data=t.readUint8Array(n)}}});s.createFullBoxCtor("iinf",function(t){var e;this.version===0?this.entry_count=t.readUint16():this.entry_count=t.readUint32(),this.item_infos=[];for(var i=0;i<this.entry_count;i++)if(e=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),e.code===s.OK)e.box.type!=="infe"&&p.error("BoxParser","Expected 'infe' box, got "+e.box.type),this.item_infos[i]=e.box;else return});s.createFullBoxCtor("iloc",function(t){var e;e=t.readUint8(),this.offset_size=e>>4&15,this.length_size=e&15,e=t.readUint8(),this.base_offset_size=e>>4&15,this.version===1||this.version===2?this.index_size=e&15:this.index_size=0,this.items=[];var i=0;if(this.version<2)i=t.readUint16();else if(this.version===2)i=t.readUint32();else throw"version of iloc box not supported";for(var r=0;r<i;r++){var n={};if(this.items.push(n),this.version<2)n.item_ID=t.readUint16();else if(this.version===2)n.item_ID=t.readUint16();else throw"version of iloc box not supported";switch(this.version===1||this.version===2?n.construction_method=t.readUint16()&15:n.construction_method=0,n.data_reference_index=t.readUint16(),this.base_offset_size){case 0:n.base_offset=0;break;case 4:n.base_offset=t.readUint32();break;case 8:n.base_offset=t.readUint64();break;default:throw"Error reading base offset size"}var a=t.readUint16();n.extents=[];for(var o=0;o<a;o++){var h={};if(n.extents.push(h),this.version===1||this.version===2)switch(this.index_size){case 0:h.extent_index=0;break;case 4:h.extent_index=t.readUint32();break;case 8:h.extent_index=t.readUint64();break;default:throw"Error reading extent index"}switch(this.offset_size){case 0:h.extent_offset=0;break;case 4:h.extent_offset=t.readUint32();break;case 8:h.extent_offset=t.readUint64();break;default:throw"Error reading extent index"}switch(this.length_size){case 0:h.extent_length=0;break;case 4:h.extent_length=t.readUint32();break;case 8:h.extent_length=t.readUint64();break;default:throw"Error reading extent index"}}}});s.createBoxCtor("imir",function(t){var e=t.readUint8();this.reserved=e>>7,this.axis=e&1});s.createFullBoxCtor("infe",function(t){if((this.version===0||this.version===1)&&(this.item_ID=t.readUint16(),this.item_protection_index=t.readUint16(),this.item_name=t.readCString(),this.content_type=t.readCString(),this.content_encoding=t.readCString()),this.version===1){this.extension_type=t.readString(4),p.warn("BoxParser","Cannot parse extension type"),t.seek(this.start+this.size);return}this.version>=2&&(this.version===2?this.item_ID=t.readUint16():this.version===3&&(this.item_ID=t.readUint32()),this.item_protection_index=t.readUint16(),this.item_type=t.readString(4),this.item_name=t.readCString(),this.item_type==="mime"?(this.content_type=t.readCString(),this.content_encoding=t.readCString()):this.item_type==="uri "&&(this.item_uri_type=t.readCString()))});s.createFullBoxCtor("ipma",function(t){var e,i;for(entry_count=t.readUint32(),this.associations=[],e=0;e<entry_count;e++){var r={};this.associations.push(r),this.version<1?r.id=t.readUint16():r.id=t.readUint32();var n=t.readUint8();for(r.props=[],i=0;i<n;i++){var a=t.readUint8(),o={};r.props.push(o),o.essential=(a&128)>>7===1,this.flags&1?o.property_index=(a&127)<<8|t.readUint8():o.property_index=a&127}}});s.createFullBoxCtor("iref",function(t){var e,i,r;for(this.references=[];t.getPosition()<this.start+this.size;)if(e=s.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===s.OK)this.version===0?r=new s.SingleItemTypeReferenceBox(e.type,e.size,e.hdr_size,e.start):r=new s.SingleItemTypeReferenceBoxLarge(e.type,e.size,e.hdr_size,e.start),r.write===s.Box.prototype.write&&r.type!=="mdat"&&(p.warn("BoxParser",r.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),r.parseDataAndRewind(t)),r.parse(t),this.references.push(r);else return});s.createBoxCtor("irot",function(t){this.angle=t.readUint8()&3});s.createFullBoxCtor("ispe",function(t){this.image_width=t.readUint32(),this.image_height=t.readUint32()});s.createFullBoxCtor("kind",function(t){this.schemeURI=t.readCString(),this.value=t.readCString()});s.createFullBoxCtor("leva",function(t){var e=t.readUint8();this.levels=[];for(var i=0;i<e;i++){var r={};this.levels[i]=r,r.track_ID=t.readUint32();var n=t.readUint8();switch(r.padding_flag=n>>7,r.assignment_type=n&127,r.assignment_type){case 0:r.grouping_type=t.readString(4);break;case 1:r.grouping_type=t.readString(4),r.grouping_type_parameter=t.readUint32();break;case 2:break;case 3:break;case 4:r.sub_track_id=t.readUint32();break;default:p.warn("BoxParser","Unknown leva assignement type")}}});s.createBoxCtor("lsel",function(t){this.layer_id=t.readUint16()});s.createBoxCtor("maxr",function(t){this.period=t.readUint32(),this.bytes=t.readUint32()});s.createBoxCtor("mdcv",function(t){this.display_primaries=[],this.display_primaries[0]={},this.display_primaries[0].x=t.readUint16(),this.display_primaries[0].y=t.readUint16(),this.display_primaries[1]={},this.display_primaries[1].x=t.readUint16(),this.display_primaries[1].y=t.readUint16(),this.display_primaries[2]={},this.display_primaries[2].x=t.readUint16(),this.display_primaries[2].y=t.readUint16(),this.white_point={},this.white_point.x=t.readUint16(),this.white_point.y=t.readUint16(),this.max_display_mastering_luminance=t.readUint32(),this.min_display_mastering_luminance=t.readUint32()});s.createFullBoxCtor("mdhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.parseLanguage(t),t.readUint16()});s.createFullBoxCtor("mehd",function(t){this.flags&1&&(p.warn("BoxParser","mehd box incorrectly uses flags set to 1, converting version to 1"),this.version=1),this.version==1?this.fragment_duration=t.readUint64():this.fragment_duration=t.readUint32()});s.createFullBoxCtor("meta",function(t){this.boxes=[],s.ContainerBox.prototype.parse.call(this,t)});s.createFullBoxCtor("mfhd",function(t){this.sequence_number=t.readUint32()});s.createFullBoxCtor("mfro",function(t){this._size=t.readUint32()});s.createFullBoxCtor("mvhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.timescale=t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.timescale=t.readUint32(),this.duration=t.readUint32()),this.rate=t.readUint32(),this.volume=t.readUint16()>>8,t.readUint16(),t.readUint32Array(2),this.matrix=t.readUint32Array(9),t.readUint32Array(6),this.next_track_id=t.readUint32()});s.createBoxCtor("npck",function(t){this.packetssent=t.readUint32()});s.createBoxCtor("nump",function(t){this.packetssent=t.readUint64()});s.createFullBoxCtor("padb",function(t){var e=t.readUint32();this.padbits=[];for(var i=0;i<Math.floor((e+1)/2);i++)this.padbits=t.readUint8()});s.createBoxCtor("pasp",function(t){this.hSpacing=t.readUint32(),this.vSpacing=t.readUint32()});s.createBoxCtor("payl",function(t){this.text=t.readString(this.size-this.hdr_size)});s.createBoxCtor("payt",function(t){this.payloadID=t.readUint32();var e=t.readUint8();this.rtpmap_string=t.readString(e)});s.createFullBoxCtor("pdin",function(t){var e=(this.size-this.hdr_size)/8;this.rate=[],this.initial_delay=[];for(var i=0;i<e;i++)this.rate[i]=t.readUint32(),this.initial_delay[i]=t.readUint32()});s.createFullBoxCtor("pitm",function(t){this.version===0?this.item_id=t.readUint16():this.item_id=t.readUint32()});s.createFullBoxCtor("pixi",function(t){var e;for(this.num_channels=t.readUint8(),this.bits_per_channels=[],e=0;e<this.num_channels;e++)this.bits_per_channels[e]=t.readUint8()});s.createBoxCtor("pmax",function(t){this.bytes=t.readUint32()});s.createFullBoxCtor("prft",function(t){this.ref_track_id=t.readUint32(),this.ntp_timestamp=t.readUint64(),this.version===0?this.media_time=t.readUint32():this.media_time=t.readUint64()});s.createFullBoxCtor("pssh",function(t){if(this.system_id=s.parseHex16(t),this.version>0){var e=t.readUint32();this.kid=[];for(var i=0;i<e;i++)this.kid[i]=s.parseHex16(t)}var r=t.readUint32();r>0&&(this.data=t.readUint8Array(r))});s.createFullBoxCtor("clef",function(t){this.width=t.readUint32(),this.height=t.readUint32()});s.createFullBoxCtor("enof",function(t){this.width=t.readUint32(),this.height=t.readUint32()});s.createFullBoxCtor("prof",function(t){this.width=t.readUint32(),this.height=t.readUint32()});s.createContainerBoxCtor("tapt",null,["clef","prof","enof"]);s.createBoxCtor("rtp ",function(t){this.descriptionformat=t.readString(4),this.sdptext=t.readString(this.size-this.hdr_size-4)});s.createFullBoxCtor("saio",function(t){this.flags&1&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32());var e=t.readUint32();this.offset=[];for(var i=0;i<e;i++)this.version===0?this.offset[i]=t.readUint32():this.offset[i]=t.readUint64()});s.createFullBoxCtor("saiz",function(t){this.flags&1&&(this.aux_info_type=t.readUint32(),this.aux_info_type_parameter=t.readUint32()),this.default_sample_info_size=t.readUint8();var e=t.readUint32();if(this.sample_info_size=[],this.default_sample_info_size===0)for(var i=0;i<e;i++)this.sample_info_size[i]=t.readUint8()});s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"mett",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)});s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"metx",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.parseFooter(t)});s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"sbtt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)});s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"stpp",function(t){this.parseHeader(t),this.namespace=t.readCString(),this.schema_location=t.readCString(),this.auxiliary_mime_types=t.readCString(),this.parseFooter(t)});s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"stxt",function(t){this.parseHeader(t),this.content_encoding=t.readCString(),this.mime_format=t.readCString(),this.parseFooter(t)});s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_SUBTITLE,"tx3g",function(t){this.parseHeader(t),this.displayFlags=t.readUint32(),this.horizontal_justification=t.readInt8(),this.vertical_justification=t.readInt8(),this.bg_color_rgba=t.readUint8Array(4),this.box_record=t.readInt16Array(4),this.style_record=t.readUint8Array(12),this.parseFooter(t)});s.createSampleEntryCtor(s.SAMPLE_ENTRY_TYPE_METADATA,"wvtt",function(t){this.parseHeader(t),this.parseFooter(t)});s.createSampleGroupCtor("alst",function(t){var e,i=t.readUint16();for(this.first_output_sample=t.readUint16(),this.sample_offset=[],e=0;e<i;e++)this.sample_offset[e]=t.readUint32();var r=this.description_length-4-4*i;for(this.num_output_samples=[],this.num_total_samples=[],e=0;e<r/4;e++)this.num_output_samples[e]=t.readUint16(),this.num_total_samples[e]=t.readUint16()});s.createSampleGroupCtor("avll",function(t){this.layerNumber=t.readUint8(),this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()});s.createSampleGroupCtor("avss",function(t){this.subSequenceIdentifier=t.readUint16(),this.layerNumber=t.readUint8();var e=t.readUint8();this.durationFlag=e>>7,this.avgRateFlag=e>>6&1,this.durationFlag&&(this.duration=t.readUint32()),this.avgRateFlag&&(this.accurateStatisticsFlag=t.readUint8(),this.avgBitRate=t.readUint16(),this.avgFrameRate=t.readUint16()),this.dependency=[];for(var i=t.readUint8(),r=0;r<i;r++){var n={};this.dependency.push(n),n.subSeqDirectionFlag=t.readUint8(),n.layerNumber=t.readUint8(),n.subSequenceIdentifier=t.readUint16()}});s.createSampleGroupCtor("dtrt",function(t){p.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")});s.createSampleGroupCtor("mvif",function(t){p.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")});s.createSampleGroupCtor("prol",function(t){this.roll_distance=t.readInt16()});s.createSampleGroupCtor("rap ",function(t){var e=t.readUint8();this.num_leading_samples_known=e>>7,this.num_leading_samples=e&127});s.createSampleGroupCtor("rash",function(t){if(this.operation_point_count=t.readUint16(),this.description_length!==2+(this.operation_point_count===1?2:this.operation_point_count*6)+9)p.warn("BoxParser","Mismatch in "+this.grouping_type+" sample group length"),this.data=t.readUint8Array(this.description_length-2);else{if(this.operation_point_count===1)this.target_rate_share=t.readUint16();else{this.target_rate_share=[],this.available_bitrate=[];for(var e=0;e<this.operation_point_count;e++)this.available_bitrate[e]=t.readUint32(),this.target_rate_share[e]=t.readUint16()}this.maximum_bitrate=t.readUint32(),this.minimum_bitrate=t.readUint32(),this.discard_priority=t.readUint8()}});s.createSampleGroupCtor("roll",function(t){this.roll_distance=t.readInt16()});s.SampleGroupEntry.prototype.parse=function(t){p.warn("BoxParser","Unknown Sample Group type: "+this.grouping_type),this.data=t.readUint8Array(this.description_length)};s.createSampleGroupCtor("scif",function(t){p.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")});s.createSampleGroupCtor("scnm",function(t){p.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")});s.createSampleGroupCtor("seig",function(t){this.reserved=t.readUint8();var e=t.readUint8();this.crypt_byte_block=e>>4,this.skip_byte_block=e&15,this.isProtected=t.readUint8(),this.Per_Sample_IV_Size=t.readUint8(),this.KID=s.parseHex16(t),this.constant_IV_size=0,this.constant_IV=0,this.isProtected===1&&this.Per_Sample_IV_Size===0&&(this.constant_IV_size=t.readUint8(),this.constant_IV=t.readUint8Array(this.constant_IV_size))});s.createSampleGroupCtor("stsa",function(t){p.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")});s.createSampleGroupCtor("sync",function(t){var e=t.readUint8();this.NAL_unit_type=e&63});s.createSampleGroupCtor("tele",function(t){var e=t.readUint8();this.level_independently_decodable=e>>7});s.createSampleGroupCtor("tsas",function(t){p.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")});s.createSampleGroupCtor("tscl",function(t){p.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")});s.createSampleGroupCtor("vipr",function(t){p.warn("BoxParser","Sample Group type: "+this.grouping_type+" not fully parsed")});s.createFullBoxCtor("sbgp",function(t){this.grouping_type=t.readString(4),this.version===1?this.grouping_type_parameter=t.readUint32():this.grouping_type_parameter=0,this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var r={};this.entries.push(r),r.sample_count=t.readInt32(),r.group_description_index=t.readInt32()}});s.createFullBoxCtor("schm",function(t){this.scheme_type=t.readString(4),this.scheme_version=t.readUint32(),this.flags&1&&(this.scheme_uri=t.readString(this.size-this.hdr_size-8))});s.createBoxCtor("sdp ",function(t){this.sdptext=t.readString(this.size-this.hdr_size)});s.createFullBoxCtor("sdtp",function(t){var e,i=this.size-this.hdr_size;this.is_leading=[],this.sample_depends_on=[],this.sample_is_depended_on=[],this.sample_has_redundancy=[];for(var r=0;r<i;r++)e=t.readUint8(),this.is_leading[r]=e>>6,this.sample_depends_on[r]=e>>4&3,this.sample_is_depended_on[r]=e>>2&3,this.sample_has_redundancy[r]=e&3});s.createFullBoxCtor("senc");s.createFullBoxCtor("sgpd",function(t){this.grouping_type=t.readString(4),p.debug("BoxParser","Found Sample Groups of type "+this.grouping_type),this.version===1?this.default_length=t.readUint32():this.default_length=0,this.version>=2&&(this.default_group_description_index=t.readUint32()),this.entries=[];for(var e=t.readUint32(),i=0;i<e;i++){var r;s[this.grouping_type+"SampleGroupEntry"]?r=new s[this.grouping_type+"SampleGroupEntry"](this.grouping_type):r=new s.SampleGroupEntry(this.grouping_type),this.entries.push(r),this.version===1?this.default_length===0?r.description_length=t.readUint32():r.description_length=this.default_length:r.description_length=this.default_length,r.write===s.SampleGroupEntry.prototype.write&&(p.info("BoxParser","SampleGroup for type "+this.grouping_type+" writing not yet implemented, keeping unparsed data in memory for later write"),r.data=t.readUint8Array(r.description_length),t.position-=r.description_length),r.parse(t)}});s.createFullBoxCtor("sidx",function(t){this.reference_ID=t.readUint32(),this.timescale=t.readUint32(),this.version===0?(this.earliest_presentation_time=t.readUint32(),this.first_offset=t.readUint32()):(this.earliest_presentation_time=t.readUint64(),this.first_offset=t.readUint64()),t.readUint16(),this.references=[];for(var e=t.readUint16(),i=0;i<e;i++){var r={};this.references.push(r);var n=t.readUint32();r.reference_type=n>>31&1,r.referenced_size=n&2147483647,r.subsegment_duration=t.readUint32(),n=t.readUint32(),r.starts_with_SAP=n>>31&1,r.SAP_type=n>>28&7,r.SAP_delta_time=n&268435455}});s.SingleItemTypeReferenceBox=function(t,e,i,r){s.Box.call(this,t,e),this.hdr_size=i,this.start=r};s.SingleItemTypeReferenceBox.prototype=new s.Box;s.SingleItemTypeReferenceBox.prototype.parse=function(t){this.from_item_ID=t.readUint16();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint16()};s.SingleItemTypeReferenceBoxLarge=function(t,e,i,r){s.Box.call(this,t,e),this.hdr_size=i,this.start=r};s.SingleItemTypeReferenceBoxLarge.prototype=new s.Box;s.SingleItemTypeReferenceBoxLarge.prototype.parse=function(t){this.from_item_ID=t.readUint32();var e=t.readUint16();this.references=[];for(var i=0;i<e;i++)this.references[i]=t.readUint32()};s.createFullBoxCtor("SmDm",function(t){this.primaryRChromaticity_x=t.readUint16(),this.primaryRChromaticity_y=t.readUint16(),this.primaryGChromaticity_x=t.readUint16(),this.primaryGChromaticity_y=t.readUint16(),this.primaryBChromaticity_x=t.readUint16(),this.primaryBChromaticity_y=t.readUint16(),this.whitePointChromaticity_x=t.readUint16(),this.whitePointChromaticity_y=t.readUint16(),this.luminanceMax=t.readUint32(),this.luminanceMin=t.readUint32()});s.createFullBoxCtor("smhd",function(t){this.balance=t.readUint16(),t.readUint16()});s.createFullBoxCtor("ssix",function(t){this.subsegments=[];for(var e=t.readUint32(),i=0;i<e;i++){var r={};this.subsegments.push(r),r.ranges=[];for(var n=t.readUint32(),a=0;a<n;a++){var o={};r.ranges.push(o),o.level=t.readUint8(),o.range_size=t.readUint24()}}});s.createFullBoxCtor("stco",function(t){var e;if(e=t.readUint32(),this.chunk_offsets=[],this.version===0)for(var i=0;i<e;i++)this.chunk_offsets.push(t.readUint32())});s.createFullBoxCtor("stdp",function(t){var e=(this.size-this.hdr_size)/2;this.priority=[];for(var i=0;i<e;i++)this.priority[i]=t.readUint16()});s.createFullBoxCtor("sthd");s.createFullBoxCtor("stri",function(t){this.switch_group=t.readUint16(),this.alternate_group=t.readUint16(),this.sub_track_id=t.readUint32();var e=(this.size-this.hdr_size-8)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()});s.createFullBoxCtor("stsc",function(t){var e,i;if(e=t.readUint32(),this.first_chunk=[],this.samples_per_chunk=[],this.sample_description_index=[],this.version===0)for(i=0;i<e;i++)this.first_chunk.push(t.readUint32()),this.samples_per_chunk.push(t.readUint32()),this.sample_description_index.push(t.readUint32())});s.createFullBoxCtor("stsd",function(t){var e,i,r,n;for(this.entries=[],r=t.readUint32(),e=1;e<=r;e++)if(i=s.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),i.code===s.OK)s[i.type+"SampleEntry"]?(n=new s[i.type+"SampleEntry"](i.size),n.hdr_size=i.hdr_size,n.start=i.start):(p.warn("BoxParser","Unknown sample entry type: "+i.type),n=new s.SampleEntry(i.type,i.size,i.hdr_size,i.start)),n.write===s.SampleEntry.prototype.write&&(p.info("BoxParser","SampleEntry "+n.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),n.parseDataAndRewind(t)),n.parse(t),this.entries.push(n);else return});s.createFullBoxCtor("stsg",function(t){this.grouping_type=t.readUint32();var e=t.readUint16();this.group_description_index=[];for(var i=0;i<e;i++)this.group_description_index[i]=t.readUint32()});s.createFullBoxCtor("stsh",function(t){var e,i;if(e=t.readUint32(),this.shadowed_sample_numbers=[],this.sync_sample_numbers=[],this.version===0)for(i=0;i<e;i++)this.shadowed_sample_numbers.push(t.readUint32()),this.sync_sample_numbers.push(t.readUint32())});s.createFullBoxCtor("stss",function(t){var e,i;if(i=t.readUint32(),this.version===0)for(this.sample_numbers=[],e=0;e<i;e++)this.sample_numbers.push(t.readUint32())});s.createFullBoxCtor("stsz",function(t){var e;if(this.sample_sizes=[],this.version===0)for(this.sample_size=t.readUint32(),this.sample_count=t.readUint32(),e=0;e<this.sample_count;e++)this.sample_size===0?this.sample_sizes.push(t.readUint32()):this.sample_sizes[e]=this.sample_size});s.createFullBoxCtor("stts",function(t){var e,i,r;if(e=t.readUint32(),this.sample_counts=[],this.sample_deltas=[],this.version===0)for(i=0;i<e;i++)this.sample_counts.push(t.readUint32()),r=t.readInt32(),r<0&&(p.warn("BoxParser","File uses negative stts sample delta, using value 1 instead, sync may be lost!"),r=1),this.sample_deltas.push(r)});s.createFullBoxCtor("stvi",function(t){var e=t.readUint32();this.single_view_allowed=e&3,this.stereo_scheme=t.readUint32();var i=t.readUint32();this.stereo_indication_type=t.readString(i);var r,n;for(this.boxes=[];t.getPosition()<this.start+this.size;)if(r=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),r.code===s.OK)n=r.box,this.boxes.push(n),this[n.type]=n;else return});s.createBoxCtor("styp",function(t){s.ftypBox.prototype.parse.call(this,t)});s.createFullBoxCtor("stz2",function(t){var e,i,r;if(this.sample_sizes=[],this.version===0)if(this.reserved=t.readUint24(),this.field_size=t.readUint8(),r=t.readUint32(),this.field_size===4)for(e=0;e<r;e+=2){var n=t.readUint8();this.sample_sizes[e]=n>>4&15,this.sample_sizes[e+1]=n&15}else if(this.field_size===8)for(e=0;e<r;e++)this.sample_sizes[e]=t.readUint8();else if(this.field_size===16)for(e=0;e<r;e++)this.sample_sizes[e]=t.readUint16();else p.error("BoxParser","Error in length field in stz2 box")});s.createFullBoxCtor("subs",function(t){var e,i,r,n;for(r=t.readUint32(),this.entries=[],e=0;e<r;e++){var a={};if(this.entries[e]=a,a.sample_delta=t.readUint32(),a.subsamples=[],n=t.readUint16(),n>0)for(i=0;i<n;i++){var o={};a.subsamples.push(o),this.version==1?o.size=t.readUint32():o.size=t.readUint16(),o.priority=t.readUint8(),o.discardable=t.readUint8(),o.codec_specific_parameters=t.readUint32()}}});s.createFullBoxCtor("tenc",function(t){if(t.readUint8(),this.version===0)t.readUint8();else{var e=t.readUint8();this.default_crypt_byte_block=e>>4&15,this.default_skip_byte_block=e&15}this.default_isProtected=t.readUint8(),this.default_Per_Sample_IV_Size=t.readUint8(),this.default_KID=s.parseHex16(t),this.default_isProtected===1&&this.default_Per_Sample_IV_Size===0&&(this.default_constant_IV_size=t.readUint8(),this.default_constant_IV=t.readUint8Array(this.default_constant_IV_size))});s.createFullBoxCtor("tfdt",function(t){this.version==1?this.baseMediaDecodeTime=t.readUint64():this.baseMediaDecodeTime=t.readUint32()});s.createFullBoxCtor("tfhd",function(t){var e=0;this.track_id=t.readUint32(),this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET?(this.base_data_offset=t.readUint64(),e+=8):this.base_data_offset=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_DESC?(this.default_sample_description_index=t.readUint32(),e+=4):this.default_sample_description_index=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_DUR?(this.default_sample_duration=t.readUint32(),e+=4):this.default_sample_duration=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_SIZE?(this.default_sample_size=t.readUint32(),e+=4):this.default_sample_size=0,this.size-this.hdr_size>e&&this.flags&s.TFHD_FLAG_SAMPLE_FLAGS?(this.default_sample_flags=t.readUint32(),e+=4):this.default_sample_flags=0});s.createFullBoxCtor("tfra",function(t){this.track_ID=t.readUint32(),t.readUint24();var e=t.readUint8();this.length_size_of_traf_num=e>>4&3,this.length_size_of_trun_num=e>>2&3,this.length_size_of_sample_num=e&3,this.entries=[];for(var i=t.readUint32(),r=0;r<i;r++)this.version===1?(this.time=t.readUint64(),this.moof_offset=t.readUint64()):(this.time=t.readUint32(),this.moof_offset=t.readUint32()),this.traf_number=t["readUint"+8*(this.length_size_of_traf_num+1)](),this.trun_number=t["readUint"+8*(this.length_size_of_trun_num+1)](),this.sample_number=t["readUint"+8*(this.length_size_of_sample_num+1)]()});s.createFullBoxCtor("tkhd",function(t){this.version==1?(this.creation_time=t.readUint64(),this.modification_time=t.readUint64(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint64()):(this.creation_time=t.readUint32(),this.modification_time=t.readUint32(),this.track_id=t.readUint32(),t.readUint32(),this.duration=t.readUint32()),t.readUint32Array(2),this.layer=t.readInt16(),this.alternate_group=t.readInt16(),this.volume=t.readInt16()>>8,t.readUint16(),this.matrix=t.readInt32Array(9),this.width=t.readUint32(),this.height=t.readUint32()});s.createBoxCtor("tmax",function(t){this.time=t.readUint32()});s.createBoxCtor("tmin",function(t){this.time=t.readUint32()});s.createBoxCtor("totl",function(t){this.bytessent=t.readUint32()});s.createBoxCtor("tpay",function(t){this.bytessent=t.readUint32()});s.createBoxCtor("tpyl",function(t){this.bytessent=t.readUint64()});s.TrackGroupTypeBox.prototype.parse=function(t){this.parseFullHeader(t),this.track_group_id=t.readUint32()};s.createTrackGroupCtor("msrc");s.TrackReferenceTypeBox=function(t,e,i,r){s.Box.call(this,t,e),this.hdr_size=i,this.start=r};s.TrackReferenceTypeBox.prototype=new s.Box;s.TrackReferenceTypeBox.prototype.parse=function(t){this.track_ids=t.readUint32Array((this.size-this.hdr_size)/4)};s.trefBox.prototype.parse=function(t){for(var e,i;t.getPosition()<this.start+this.size;)if(e=s.parseOneBox(t,!0,this.size-(t.getPosition()-this.start)),e.code===s.OK)i=new s.TrackReferenceTypeBox(e.type,e.size,e.hdr_size,e.start),i.write===s.Box.prototype.write&&i.type!=="mdat"&&(p.info("BoxParser","TrackReference "+i.type+" box writing not yet implemented, keeping unparsed data in memory for later write"),i.parseDataAndRewind(t)),i.parse(t),this.boxes.push(i);else return};s.createFullBoxCtor("trep",function(t){for(this.track_ID=t.readUint32(),this.boxes=[];t.getPosition()<this.start+this.size;)if(ret=s.parseOneBox(t,!1,this.size-(t.getPosition()-this.start)),ret.code===s.OK)box=ret.box,this.boxes.push(box);else return});s.createFullBoxCtor("trex",function(t){this.track_id=t.readUint32(),this.default_sample_description_index=t.readUint32(),this.default_sample_duration=t.readUint32(),this.default_sample_size=t.readUint32(),this.default_sample_flags=t.readUint32()});s.createBoxCtor("trpy",function(t){this.bytessent=t.readUint64()});s.createFullBoxCtor("trun",function(t){var e=0;if(this.sample_count=t.readUint32(),e+=4,this.size-this.hdr_size>e&&this.flags&s.TRUN_FLAGS_DATA_OFFSET?(this.data_offset=t.readInt32(),e+=4):this.data_offset=0,this.size-this.hdr_size>e&&this.flags&s.TRUN_FLAGS_FIRST_FLAG?(this.first_sample_flags=t.readUint32(),e+=4):this.first_sample_flags=0,this.sample_duration=[],this.sample_size=[],this.sample_flags=[],this.sample_composition_time_offset=[],this.size-this.hdr_size>e)for(var i=0;i<this.sample_count;i++)this.flags&s.TRUN_FLAGS_DURATION&&(this.sample_duration[i]=t.readUint32()),this.flags&s.TRUN_FLAGS_SIZE&&(this.sample_size[i]=t.readUint32()),this.flags&s.TRUN_FLAGS_FLAGS&&(this.sample_flags[i]=t.readUint32()),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?this.sample_composition_time_offset[i]=t.readUint32():this.sample_composition_time_offset[i]=t.readInt32())});s.createFullBoxCtor("tsel",function(t){this.switch_group=t.readUint32();var e=(this.size-this.hdr_size-4)/4;this.attribute_list=[];for(var i=0;i<e;i++)this.attribute_list[i]=t.readUint32()});s.createFullBoxCtor("txtC",function(t){this.config=t.readCString()});s.createFullBoxCtor("url ",function(t){this.flags!==1&&(this.location=t.readCString())});s.createFullBoxCtor("urn ",function(t){this.name=t.readCString(),this.size-this.hdr_size-this.name.length-1>0&&(this.location=t.readCString())});s.createUUIDBox("a5d40b30e81411ddba2f0800200c9a66",!0,!1,function(t){this.LiveServerManifest=t.readString(this.size-this.hdr_size).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")});s.createUUIDBox("d08a4f1810f34a82b6c832d8aba183d3",!0,!1,function(t){this.system_id=s.parseHex16(t);var e=t.readUint32();e>0&&(this.data=t.readUint8Array(e))});s.createUUIDBox("a2394f525a9b4f14a2446c427c648df4",!0,!1);s.createUUIDBox("8974dbce7be74c5184f97148f9882554",!0,!1,function(t){this.default_AlgorithmID=t.readUint24(),this.default_IV_size=t.readUint8(),this.default_KID=s.parseHex16(t)});s.createUUIDBox("d4807ef2ca3946958e5426cb9e46a79f",!0,!1,function(t){this.fragment_count=t.readUint8(),this.entries=[];for(var e=0;e<this.fragment_count;e++){var i={},r=0,n=0;this.version===1?(r=t.readUint64(),n=t.readUint64()):(r=t.readUint32(),n=t.readUint32()),i.absolute_time=r,i.absolute_duration=n,this.entries.push(i)}});s.createUUIDBox("6d1d9b0542d544e680e2141daff757b2",!0,!1,function(t){this.version===1?(this.absolute_time=t.readUint64(),this.duration=t.readUint64()):(this.absolute_time=t.readUint32(),this.duration=t.readUint32())});s.createFullBoxCtor("vmhd",function(t){this.graphicsmode=t.readUint16(),this.opcolor=t.readUint16Array(3)});s.createFullBoxCtor("vpcC",function(t){var e;this.version===1?(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4,this.chromaSubsampling=e>>1&7,this.videoFullRangeFlag=e&1,this.colourPrimaries=t.readUint8(),this.transferCharacteristics=t.readUint8(),this.matrixCoefficients=t.readUint8(),this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize)):(this.profile=t.readUint8(),this.level=t.readUint8(),e=t.readUint8(),this.bitDepth=e>>4&15,this.colorSpace=e&15,e=t.readUint8(),this.chromaSubsampling=e>>4&15,this.transferFunction=e>>1&7,this.videoFullRangeFlag=e&1,this.codecIntializationDataSize=t.readUint16(),this.codecIntializationData=t.readUint8Array(this.codecIntializationDataSize))});s.createBoxCtor("vttC",function(t){this.text=t.readString(this.size-this.hdr_size)});s.createFullBoxCtor("vvcC",function(t){var e,i,r={held_bits:void 0,num_held_bits:0,stream_read_1_bytes:function(_){this.held_bits=_.readUint8(),this.num_held_bits=8},stream_read_2_bytes:function(_){this.held_bits=_.readUint16(),this.num_held_bits=16},extract_bits:function(_){var b=this.held_bits>>this.num_held_bits-_&(1<<_)-1;return this.num_held_bits-=_,b}};if(r.stream_read_1_bytes(t),r.extract_bits(5),this.lengthSizeMinusOne=r.extract_bits(2),this.ptl_present_flag=r.extract_bits(1),this.ptl_present_flag){r.stream_read_2_bytes(t),this.ols_idx=r.extract_bits(9),this.num_sublayers=r.extract_bits(3),this.constant_frame_rate=r.extract_bits(2),this.chroma_format_idc=r.extract_bits(2),r.stream_read_1_bytes(t),this.bit_depth_minus8=r.extract_bits(3),r.extract_bits(5);{if(r.stream_read_2_bytes(t),r.extract_bits(2),this.num_bytes_constraint_info=r.extract_bits(6),this.general_profile_idc=r.extract_bits(7),this.general_tier_flag=r.extract_bits(1),this.general_level_idc=t.readUint8(),r.stream_read_1_bytes(t),this.ptl_frame_only_constraint_flag=r.extract_bits(1),this.ptl_multilayer_enabled_flag=r.extract_bits(1),this.general_constraint_info=new Uint8Array(this.num_bytes_constraint_info),this.num_bytes_constraint_info){for(e=0;e<this.num_bytes_constraint_info-1;e++){var n=r.extract_bits(6);r.stream_read_1_bytes(t);var a=r.extract_bits(2);this.general_constraint_info[e]=n<<2|a}this.general_constraint_info[this.num_bytes_constraint_info-1]=r.extract_bits(6)}else r.extract_bits(6);for(r.stream_read_1_bytes(t),this.ptl_sublayer_present_mask=0,i=this.num_sublayers-2;i>=0;--i){var o=r.extract_bits(1);this.ptl_sublayer_present_mask|=o<<i}for(i=this.num_sublayers;i<=8&&this.num_sublayers>1;++i)r.extract_bits(1);for(i=this.num_sublayers-2;i>=0;--i)this.ptl_sublayer_present_mask&1<<i&&(this.sublayer_level_idc[i]=t.readUint8());if(this.ptl_num_sub_profiles=t.readUint8(),this.general_sub_profile_idc=[],this.ptl_num_sub_profiles)for(e=0;e<this.ptl_num_sub_profiles;e++)this.general_sub_profile_idc.push(t.readUint32())}this.max_picture_width=t.readUint16(),this.max_picture_height=t.readUint16(),this.avg_frame_rate=t.readUint16()}var h=12,f=13;this.nalu_arrays=[];var d=t.readUint8();for(e=0;e<d;e++){var u=[];this.nalu_arrays.push(u),r.stream_read_1_bytes(t),u.completeness=r.extract_bits(1),r.extract_bits(2),u.nalu_type=r.extract_bits(5);var y=1;for(u.nalu_type!=f&&u.nalu_type!=h&&(y=t.readUint16()),i=0;i<y;i++){var g=t.readUint16();u.push({data:t.readUint8Array(g),length:g})}}});s.createFullBoxCtor("vvnC",function(t){var e=strm.readUint8();this.lengthSizeMinusOne=e&3});s.SampleEntry.prototype.isVideo=function(){return!1};s.SampleEntry.prototype.isAudio=function(){return!1};s.SampleEntry.prototype.isSubtitle=function(){return!1};s.SampleEntry.prototype.isMetadata=function(){return!1};s.SampleEntry.prototype.isHint=function(){return!1};s.SampleEntry.prototype.getCodec=function(){return this.type.replace(".","")};s.SampleEntry.prototype.getWidth=function(){return""};s.SampleEntry.prototype.getHeight=function(){return""};s.SampleEntry.prototype.getChannelCount=function(){return""};s.SampleEntry.prototype.getSampleRate=function(){return""};s.SampleEntry.prototype.getSampleSize=function(){return""};s.VisualSampleEntry.prototype.isVideo=function(){return!0};s.VisualSampleEntry.prototype.getWidth=function(){return this.width};s.VisualSampleEntry.prototype.getHeight=function(){return this.height};s.AudioSampleEntry.prototype.isAudio=function(){return!0};s.AudioSampleEntry.prototype.getChannelCount=function(){return this.channel_count};s.AudioSampleEntry.prototype.getSampleRate=function(){return this.samplerate};s.AudioSampleEntry.prototype.getSampleSize=function(){return this.samplesize};s.SubtitleSampleEntry.prototype.isSubtitle=function(){return!0};s.MetadataSampleEntry.prototype.isMetadata=function(){return!0};s.decimalToHex=function(t,e){var i=Number(t).toString(16);for(e=typeof e>"u"||e===null?e=2:e;i.length<e;)i="0"+i;return i};s.avc1SampleEntry.prototype.getCodec=s.avc2SampleEntry.prototype.getCodec=s.avc3SampleEntry.prototype.getCodec=s.avc4SampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this);return this.avcC?t+"."+s.decimalToHex(this.avcC.AVCProfileIndication)+s.decimalToHex(this.avcC.profile_compatibility)+s.decimalToHex(this.avcC.AVCLevelIndication):t};s.hev1SampleEntry.prototype.getCodec=s.hvc1SampleEntry.prototype.getCodec=function(){var t,e=s.SampleEntry.prototype.getCodec.call(this);if(this.hvcC){switch(e+=".",this.hvcC.general_profile_space){case 0:e+="";break;case 1:e+="A";break;case 2:e+="B";break;case 3:e+="C";break}e+=this.hvcC.general_profile_idc,e+=".";var i=this.hvcC.general_profile_compatibility,r=0;for(t=0;t<32&&(r|=i&1,t!=31);t++)r<<=1,i>>=1;e+=s.decimalToHex(r,0),e+=".",this.hvcC.general_tier_flag===0?e+="L":e+="H",e+=this.hvcC.general_level_idc;var n=!1,a="";for(t=5;t>=0;t--)(this.hvcC.general_constraint_indicator[t]||n)&&(a="."+s.decimalToHex(this.hvcC.general_constraint_indicator[t],0)+a,n=!0);e+=a}return e};s.vvc1SampleEntry.prototype.getCodec=s.vvi1SampleEntry.prototype.getCodec=function(){var t,e=s.SampleEntry.prototype.getCodec.call(this);if(this.vvcC){e+="."+this.vvcC.general_profile_idc,this.vvcC.general_tier_flag?e+=".H":e+=".L",e+=this.vvcC.general_level_idc;var i="";if(this.vvcC.general_constraint_info){var r=[],n=0;n|=this.vvcC.ptl_frame_only_constraint<<7,n|=this.vvcC.ptl_multilayer_enabled<<6;var a;for(t=0;t<this.vvcC.general_constraint_info.length;++t)n|=this.vvcC.general_constraint_info[t]>>2&63,r.push(n),n&&(a=t),n=this.vvcC.general_constraint_info[t]>>2&3;if(a===void 0)i=".CA";else{i=".C";var o="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",h=0,f=0;for(t=0;t<=a;++t)for(h=h<<8|r[t],f+=8;f>=5;){var d=h>>f-5&31;i+=o[d],f-=5,h&=(1<<f)-1}f&&(h<<=5-f,i+=o[h&31])}}e+=i}return e};s.mp4aSampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this);if(this.esds&&this.esds.esd){var e=this.esds.esd.getOTI(),i=this.esds.esd.getAudioConfig();return t+"."+s.decimalToHex(e)+(i?"."+i:"")}else return t};s.stxtSampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this);return this.mime_format?t+"."+this.mime_format:t};s.vp08SampleEntry.prototype.getCodec=s.vp09SampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this),e=this.vpcC.level;e==0&&(e="00");var i=this.vpcC.bitDepth;return i==8&&(i="08"),t+".0"+this.vpcC.profile+"."+e+"."+i};s.av01SampleEntry.prototype.getCodec=function(){var t=s.SampleEntry.prototype.getCodec.call(this),e=this.av1C.seq_level_idx_0;e<10&&(e="0"+e);var i;return this.av1C.seq_profile===2&&this.av1C.high_bitdepth===1?i=this.av1C.twelve_bit===1?"12":"10":this.av1C.seq_profile<=2&&(i=this.av1C.high_bitdepth===1?"10":"08"),t+"."+this.av1C.seq_profile+"."+e+(this.av1C.seq_tier_0?"H":"M")+"."+i};s.Box.prototype.writeHeader=function(t,e){this.size+=8,this.size>k&&(this.size+=8),this.type==="uuid"&&(this.size+=16),p.debug("BoxWriter","Writing box "+this.type+" of size: "+this.size+" at position "+t.getPosition()+(e||"")),this.size>k?t.writeUint32(1):(this.sizePosition=t.getPosition(),t.writeUint32(this.size)),t.writeString(this.type,null,4),this.type==="uuid"&&t.writeUint8Array(this.uuid),this.size>k&&t.writeUint64(this.size)};s.FullBox.prototype.writeHeader=function(t){this.size+=4,s.Box.prototype.writeHeader.call(this,t," v="+this.version+" f="+this.flags),t.writeUint8(this.version),t.writeUint24(this.flags)};s.Box.prototype.write=function(t){this.type==="mdat"?this.data&&(this.size=this.data.length,this.writeHeader(t),t.writeUint8Array(this.data)):(this.size=this.data?this.data.length:0,this.writeHeader(t),this.data&&t.writeUint8Array(this.data))};s.ContainerBox.prototype.write=function(t){this.size=0,this.writeHeader(t);for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&(this.boxes[e].write(t),this.size+=this.boxes[e].size);p.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)};s.TrackReferenceTypeBox.prototype.write=function(t){this.size=this.track_ids.length*4,this.writeHeader(t),t.writeUint32Array(this.track_ids)};s.avcCBox.prototype.write=function(t){var e;for(this.size=7,e=0;e<this.SPS.length;e++)this.size+=2+this.SPS[e].length;for(e=0;e<this.PPS.length;e++)this.size+=2+this.PPS[e].length;for(this.ext&&(this.size+=this.ext.length),this.writeHeader(t),t.writeUint8(this.configurationVersion),t.writeUint8(this.AVCProfileIndication),t.writeUint8(this.profile_compatibility),t.writeUint8(this.AVCLevelIndication),t.writeUint8(this.lengthSizeMinusOne+(63<<2)),t.writeUint8(this.SPS.length+(7<<5)),e=0;e<this.SPS.length;e++)t.writeUint16(this.SPS[e].length),t.writeUint8Array(this.SPS[e].nalu);for(t.writeUint8(this.PPS.length),e=0;e<this.PPS.length;e++)t.writeUint16(this.PPS[e].length),t.writeUint8Array(this.PPS[e].nalu);this.ext&&t.writeUint8Array(this.ext)};s.co64Box.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),e=0;e<this.chunk_offsets.length;e++)t.writeUint64(this.chunk_offsets[e])};s.cslgBox.prototype.write=function(t){var e;this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeInt32(this.compositionToDTSShift),t.writeInt32(this.leastDecodeToDisplayDelta),t.writeInt32(this.greatestDecodeToDisplayDelta),t.writeInt32(this.compositionStartTime),t.writeInt32(this.compositionEndTime)};s.cttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),this.version===1?t.writeInt32(this.sample_offsets[e]):t.writeUint32(this.sample_offsets[e])};s.drefBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;p.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)};s.elngBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.extended_language.length,this.writeHeader(t),t.writeString(this.extended_language)};s.elstBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+12*this.entries.length,this.writeHeader(t),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var i=this.entries[e];t.writeUint32(i.segment_duration),t.writeInt32(i.media_time),t.writeInt16(i.media_rate_integer),t.writeInt16(i.media_rate_fraction)}};s.emsgBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+this.message_data.length+(this.scheme_id_uri.length+1)+(this.value.length+1),this.writeHeader(t),t.writeCString(this.scheme_id_uri),t.writeCString(this.value),t.writeUint32(this.timescale),t.writeUint32(this.presentation_time_delta),t.writeUint32(this.event_duration),t.writeUint32(this.id),t.writeUint8Array(this.message_data)};s.ftypBox.prototype.write=function(t){this.size=8+4*this.compatible_brands.length,this.writeHeader(t),t.writeString(this.major_brand,null,4),t.writeUint32(this.minor_version);for(var e=0;e<this.compatible_brands.length;e++)t.writeString(this.compatible_brands[e],null,4)};s.hdlrBox.prototype.write=function(t){this.size=5*4+this.name.length+1,this.version=0,this.flags=0,this.writeHeader(t),t.writeUint32(0),t.writeString(this.handler,null,4),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeCString(this.name)};s.kindBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=this.schemeURI.length+1+(this.value.length+1),this.writeHeader(t),t.writeCString(this.schemeURI),t.writeCString(this.value)};s.mdhdBox.prototype.write=function(t){this.size=4*4+2*2,this.flags=0,this.version=0,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint16(this.language),t.writeUint16(0)};s.mehdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.fragment_duration)};s.mfhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4,this.writeHeader(t),t.writeUint32(this.sequence_number)};s.mvhdBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=23*4+2*2,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.timescale),t.writeUint32(this.duration),t.writeUint32(this.rate),t.writeUint16(this.volume<<8),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32Array(this.matrix),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(this.next_track_id)};s.SampleEntry.prototype.writeHeader=function(t){this.size=8,s.Box.prototype.writeHeader.call(this,t),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint8(0),t.writeUint16(this.data_reference_index)};s.SampleEntry.prototype.writeFooter=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t),this.size+=this.boxes[e].size;p.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)};s.SampleEntry.prototype.write=function(t){this.writeHeader(t),t.writeUint8Array(this.data),this.size+=this.data.length,p.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)};s.VisualSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*7+6*4+32,t.writeUint16(0),t.writeUint16(0),t.writeUint32(0),t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.width),t.writeUint16(this.height),t.writeUint32(this.horizresolution),t.writeUint32(this.vertresolution),t.writeUint32(0),t.writeUint16(this.frame_count),t.writeUint8(Math.min(31,this.compressorname.length)),t.writeString(this.compressorname,null,31),t.writeUint16(this.depth),t.writeInt16(-1),this.writeFooter(t)};s.AudioSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=2*4+3*4,t.writeUint32(0),t.writeUint32(0),t.writeUint16(this.channel_count),t.writeUint16(this.samplesize),t.writeUint16(0),t.writeUint16(0),t.writeUint32(this.samplerate<<16),this.writeFooter(t)};s.stppSampleEntry.prototype.write=function(t){this.writeHeader(t),this.size+=this.namespace.length+1+this.schema_location.length+1+this.auxiliary_mime_types.length+1,t.writeCString(this.namespace),t.writeCString(this.schema_location),t.writeCString(this.auxiliary_mime_types),this.writeFooter(t)};s.SampleGroupEntry.prototype.write=function(t){t.writeUint8Array(this.data)};s.sbgpBox.prototype.write=function(t){this.version=1,this.flags=0,this.size=12+8*this.entries.length,this.writeHeader(t),t.writeString(this.grouping_type,null,4),t.writeUint32(this.grouping_type_parameter),t.writeUint32(this.entries.length);for(var e=0;e<this.entries.length;e++){var i=this.entries[e];t.writeInt32(i.sample_count),t.writeInt32(i.group_description_index)}};s.sgpdBox.prototype.write=function(t){var e,i;for(this.flags=0,this.size=12,e=0;e<this.entries.length;e++)i=this.entries[e],this.version===1&&(this.default_length===0&&(this.size+=4),this.size+=i.data.length);for(this.writeHeader(t),t.writeString(this.grouping_type,null,4),this.version===1&&t.writeUint32(this.default_length),this.version>=2&&t.writeUint32(this.default_sample_description_index),t.writeUint32(this.entries.length),e=0;e<this.entries.length;e++)i=this.entries[e],this.version===1&&this.default_length===0&&t.writeUint32(i.description_length),i.write(t)};s.sidxBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*4+2+2+12*this.references.length,this.writeHeader(t),t.writeUint32(this.reference_ID),t.writeUint32(this.timescale),t.writeUint32(this.earliest_presentation_time),t.writeUint32(this.first_offset),t.writeUint16(0),t.writeUint16(this.references.length);for(var e=0;e<this.references.length;e++){var i=this.references[e];t.writeUint32(i.reference_type<<31|i.referenced_size),t.writeUint32(i.subsegment_duration),t.writeUint32(i.starts_with_SAP<<31|i.SAP_type<<28|i.SAP_delta_time)}};s.smhdBox.prototype.write=function(t){var e;this.version=0,this.flags=1,this.size=4,this.writeHeader(t),t.writeUint16(this.balance),t.writeUint16(0)};s.stcoBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.chunk_offsets.length,this.writeHeader(t),t.writeUint32(this.chunk_offsets.length),t.writeUint32Array(this.chunk_offsets)};s.stscBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+12*this.first_chunk.length,this.writeHeader(t),t.writeUint32(this.first_chunk.length),e=0;e<this.first_chunk.length;e++)t.writeUint32(this.first_chunk[e]),t.writeUint32(this.samples_per_chunk[e]),t.writeUint32(this.sample_description_index[e])};s.stsdBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=0,this.writeHeader(t),t.writeUint32(this.entries.length),this.size+=4,e=0;e<this.entries.length;e++)this.entries[e].write(t),this.size+=this.entries[e].size;p.debug("BoxWriter","Adjusting box "+this.type+" with new size "+this.size),t.adjustUint32(this.sizePosition,this.size)};s.stshBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.shadowed_sample_numbers.length,this.writeHeader(t),t.writeUint32(this.shadowed_sample_numbers.length),e=0;e<this.shadowed_sample_numbers.length;e++)t.writeUint32(this.shadowed_sample_numbers[e]),t.writeUint32(this.sync_sample_numbers[e])};s.stssBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4+4*this.sample_numbers.length,this.writeHeader(t),t.writeUint32(this.sample_numbers.length),t.writeUint32Array(this.sample_numbers)};s.stszBox.prototype.write=function(t){var e,i=!0;if(this.version=0,this.flags=0,this.sample_sizes.length>0)for(e=0;e+1<this.sample_sizes.length;)if(this.sample_sizes[e+1]!==this.sample_sizes[0]){i=!1;break}else e++;else i=!1;this.size=8,i||(this.size+=4*this.sample_sizes.length),this.writeHeader(t),i?t.writeUint32(this.sample_sizes[0]):t.writeUint32(0),t.writeUint32(this.sample_sizes.length),i||t.writeUint32Array(this.sample_sizes)};s.sttsBox.prototype.write=function(t){var e;for(this.version=0,this.flags=0,this.size=4+8*this.sample_counts.length,this.writeHeader(t),t.writeUint32(this.sample_counts.length),e=0;e<this.sample_counts.length;e++)t.writeUint32(this.sample_counts[e]),t.writeUint32(this.sample_deltas[e])};s.tfdtBox.prototype.write=function(t){var e=Math.pow(2,32)-1;this.version=this.baseMediaDecodeTime>e?1:0,this.flags=0,this.size=4,this.version===1&&(this.size+=4),this.writeHeader(t),this.version===1?t.writeUint64(this.baseMediaDecodeTime):t.writeUint32(this.baseMediaDecodeTime)};s.tfhdBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET&&(this.size+=8),this.flags&s.TFHD_FLAG_SAMPLE_DESC&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_DUR&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_SIZE&&(this.size+=4),this.flags&s.TFHD_FLAG_SAMPLE_FLAGS&&(this.size+=4),this.writeHeader(t),t.writeUint32(this.track_id),this.flags&s.TFHD_FLAG_BASE_DATA_OFFSET&&t.writeUint64(this.base_data_offset),this.flags&s.TFHD_FLAG_SAMPLE_DESC&&t.writeUint32(this.default_sample_description_index),this.flags&s.TFHD_FLAG_SAMPLE_DUR&&t.writeUint32(this.default_sample_duration),this.flags&s.TFHD_FLAG_SAMPLE_SIZE&&t.writeUint32(this.default_sample_size),this.flags&s.TFHD_FLAG_SAMPLE_FLAGS&&t.writeUint32(this.default_sample_flags)};s.tkhdBox.prototype.write=function(t){this.version=0,this.size=4*18+2*4,this.writeHeader(t),t.writeUint32(this.creation_time),t.writeUint32(this.modification_time),t.writeUint32(this.track_id),t.writeUint32(0),t.writeUint32(this.duration),t.writeUint32(0),t.writeUint32(0),t.writeInt16(this.layer),t.writeInt16(this.alternate_group),t.writeInt16(this.volume<<8),t.writeUint16(0),t.writeInt32Array(this.matrix),t.writeUint32(this.width),t.writeUint32(this.height)};s.trexBox.prototype.write=function(t){this.version=0,this.flags=0,this.size=4*5,this.writeHeader(t),t.writeUint32(this.track_id),t.writeUint32(this.default_sample_description_index),t.writeUint32(this.default_sample_duration),t.writeUint32(this.default_sample_size),t.writeUint32(this.default_sample_flags)};s.trunBox.prototype.write=function(t){this.version=0,this.size=4,this.flags&s.TRUN_FLAGS_DATA_OFFSET&&(this.size+=4),this.flags&s.TRUN_FLAGS_FIRST_FLAG&&(this.size+=4),this.flags&s.TRUN_FLAGS_DURATION&&(this.size+=4*this.sample_duration.length),this.flags&s.TRUN_FLAGS_SIZE&&(this.size+=4*this.sample_size.length),this.flags&s.TRUN_FLAGS_FLAGS&&(this.size+=4*this.sample_flags.length),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.size+=4*this.sample_composition_time_offset.length),this.writeHeader(t),t.writeUint32(this.sample_count),this.flags&s.TRUN_FLAGS_DATA_OFFSET&&(this.data_offset_position=t.getPosition(),t.writeInt32(this.data_offset)),this.flags&s.TRUN_FLAGS_FIRST_FLAG&&t.writeUint32(this.first_sample_flags);for(var e=0;e<this.sample_count;e++)this.flags&s.TRUN_FLAGS_DURATION&&t.writeUint32(this.sample_duration[e]),this.flags&s.TRUN_FLAGS_SIZE&&t.writeUint32(this.sample_size[e]),this.flags&s.TRUN_FLAGS_FLAGS&&t.writeUint32(this.sample_flags[e]),this.flags&s.TRUN_FLAGS_CTS_OFFSET&&(this.version===0?t.writeUint32(this.sample_composition_time_offset[e]):t.writeInt32(this.sample_composition_time_offset[e]))};s["url Box"].prototype.write=function(t){this.version=0,this.location?(this.flags=0,this.size=this.location.length+1):(this.flags=1,this.size=0),this.writeHeader(t),this.location&&t.writeCString(this.location)};s["urn Box"].prototype.write=function(t){this.version=0,this.flags=0,this.size=this.name.length+1+(this.location?this.location.length+1:0),this.writeHeader(t),t.writeCString(this.name),this.location&&t.writeCString(this.location)};s.vmhdBox.prototype.write=function(t){var e;this.version=0,this.flags=1,this.size=8,this.writeHeader(t),t.writeUint16(this.graphicsmode),t.writeUint16Array(this.opcolor)};s.cttsBox.prototype.unpack=function(t){var e,i,r;for(r=0,e=0;e<this.sample_counts.length;e++)for(i=0;i<this.sample_counts[e];i++)t[r].pts=t[r].dts+this.sample_offsets[e],r++};s.sttsBox.prototype.unpack=function(t){var e,i,r;for(r=0,e=0;e<this.sample_counts.length;e++)for(i=0;i<this.sample_counts[e];i++)r===0?t[r].dts=0:t[r].dts=t[r-1].dts+this.sample_deltas[e],r++};s.stcoBox.prototype.unpack=function(t){var e;for(e=0;e<this.chunk_offsets.length;e++)t[e].offset=this.chunk_offsets[e]};s.stscBox.prototype.unpack=function(t){var e,i,r,n,a;for(n=0,a=0,e=0;e<this.first_chunk.length;e++)for(i=0;i<(e+1<this.first_chunk.length?this.first_chunk[e+1]:1/0);i++)for(a++,r=0;r<this.samples_per_chunk[e];r++){if(t[n])t[n].description_index=this.sample_description_index[e],t[n].chunk_index=a;else return;n++}};s.stszBox.prototype.unpack=function(t){var e;for(e=0;e<this.sample_sizes.length;e++)t[e].size=this.sample_sizes[e]};s.DIFF_BOXES_PROP_NAMES=["boxes","entries","references","subsamples","items","item_infos","extents","associations","subsegments","ranges","seekLists","seekPoints","esd","levels"];s.DIFF_PRIMITIVE_ARRAY_PROP_NAMES=["compatible_brands","matrix","opcolor","sample_counts","sample_counts","sample_deltas","first_chunk","samples_per_chunk","sample_sizes","chunk_offsets","sample_offsets","sample_description_index","sample_duration"];s.boxEqualFields=function(t,e){if(t&&!e)return!1;var i;for(i in t)if(!(s.DIFF_BOXES_PROP_NAMES.indexOf(i)>-1)){if(t[i]instanceof s.Box||e[i]instanceof s.Box)continue;if(typeof t[i]>"u"||typeof e[i]>"u")continue;if(typeof t[i]=="function"||typeof e[i]=="function")continue;if(t.subBoxNames&&t.subBoxNames.indexOf(i.slice(0,4))>-1||e.subBoxNames&&e.subBoxNames.indexOf(i.slice(0,4))>-1)continue;if(i==="data"||i==="start"||i==="size"||i==="creation_time"||i==="modification_time")continue;if(s.DIFF_PRIMITIVE_ARRAY_PROP_NAMES.indexOf(i)>-1)continue;if(t[i]!==e[i])return!1}return!0};s.boxEqual=function(t,e){if(!s.boxEqualFields(t,e))return!1;for(var i=0;i<s.DIFF_BOXES_PROP_NAMES.length;i++){var r=s.DIFF_BOXES_PROP_NAMES[i];if(t[r]&&e[r]&&!s.boxEqual(t[r],e[r]))return!1}return!0};var St=function(){};St.prototype.parseSample=function(t){var e,i,r=new x(t.buffer);for(e=[];!r.isEos();)i=s.parseOneBox(r,!1),i.code===s.OK&&i.box.type==="vttc"&&e.push(i.box);return e};St.prototype.getText=function(t,e,i){function r(d,u,y){return y=y||"0",d=d+"",d.length>=u?d:new Array(u-d.length+1).join(y)+d}function n(d){var u=Math.floor(d/3600),y=Math.floor((d-u*3600)/60),g=Math.floor(d-u*3600-y*60),_=Math.floor((d-u*3600-y*60-g)*1e3);return""+r(u,2)+":"+r(y,2)+":"+r(g,2)+"."+r(_,3)}for(var a=this.parseSample(i),o="",h=0;h<a.length;h++){var f=a[h];o+=n(t)+" --> "+n(e)+`\r
`,o+=f.payl.text}return o};var wt=function(){};wt.prototype.parseSample=function(t){var e={},i;e.resources=[];var r=new x(t.data.buffer);if(!t.subsamples||t.subsamples.length===0)e.documentString=r.readString(t.data.length);else if(e.documentString=r.readString(t.subsamples[0].size),t.subsamples.length>1)for(i=1;i<t.subsamples.length;i++)e.resources[i]=r.readUint8Array(t.subsamples[i].size);return typeof DOMParser<"u"&&(e.document=new DOMParser().parseFromString(e.documentString,"application/xml")),e};var ht=function(){};ht.prototype.parseSample=function(t){var e,i=new x(t.data.buffer);return e=i.readString(t.data.length),e};ht.prototype.parseConfig=function(t){var e,i=new x(t.buffer);return i.readUint32(),e=i.readCString(),e};typeof S<"u"&&(S.XMLSubtitlein4Parser=wt,S.Textin4Parser=ht);var c=function(t){this.stream=t||new w,this.boxes=[],this.mdats=[],this.moofs=[],this.isProgressive=!1,this.moovStartFound=!1,this.onMoovStart=null,this.moovStartSent=!1,this.onReady=null,this.readySent=!1,this.onSegment=null,this.onSamples=null,this.onError=null,this.sampleListBuilt=!1,this.fragmentedTracks=[],this.extractedTracks=[],this.isFragmentationInitialized=!1,this.sampleProcessingStarted=!1,this.nextMoofNumber=0,this.itemListBuilt=!1,this.onSidx=null,this.sidxSent=!1};c.prototype.setSegmentOptions=function(t,e,i){var r=this.getTrackById(t);if(r){var n={};this.fragmentedTracks.push(n),n.id=t,n.user=e,n.trak=r,r.nextSample=0,n.segmentStream=null,n.nb_samples=1e3,n.rapAlignement=!0,i&&(i.nbSamples&&(n.nb_samples=i.nbSamples),i.rapAlignement&&(n.rapAlignement=i.rapAlignement))}};c.prototype.unsetSegmentOptions=function(t){for(var e=-1,i=0;i<this.fragmentedTracks.length;i++){var r=this.fragmentedTracks[i];r.id==t&&(e=i)}e>-1&&this.fragmentedTracks.splice(e,1)};c.prototype.setExtractionOptions=function(t,e,i){var r=this.getTrackById(t);if(r){var n={};this.extractedTracks.push(n),n.id=t,n.user=e,n.trak=r,r.nextSample=0,n.nb_samples=1e3,n.samples=[],i&&i.nbSamples&&(n.nb_samples=i.nbSamples)}};c.prototype.unsetExtractionOptions=function(t){for(var e=-1,i=0;i<this.extractedTracks.length;i++){var r=this.extractedTracks[i];r.id==t&&(e=i)}e>-1&&this.extractedTracks.splice(e,1)};c.prototype.parse=function(){var t,e,i,r=!1;if(!(this.restoreParsePosition&&!this.restoreParsePosition()))for(;;)if(this.hasIncompleteMdat&&this.hasIncompleteMdat()){if(this.processIncompleteMdat())continue;return}else if(this.saveParsePosition&&this.saveParsePosition(),e=s.parseOneBox(this.stream,r),e.code===s.ERR_NOT_ENOUGH_DATA)if(this.processIncompleteBox){if(this.processIncompleteBox(e))continue;return}else return;else{var n;switch(i=e.box,n=i.type!=="uuid"?i.type:i.uuid,this.boxes.push(i),n){case"mdat":this.mdats.push(i);break;case"moof":this.moofs.push(i);break;case"moov":this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0);default:this[n]!==void 0&&p.warn("ISOFile","Duplicate Box of type: "+n+", overriding previous occurrence"),this[n]=i;break}this.updateUsedBytes&&this.updateUsedBytes(i,e)}};c.prototype.checkBuffer=function(t){if(t==null)throw"Buffer must be defined and non empty";if(t.fileStart===void 0)throw"Buffer must have a fileStart property";return t.byteLength===0?(p.warn("ISOFile","Ignoring empty buffer (fileStart: "+t.fileStart+")"),this.stream.logBufferLevel(),!1):(p.info("ISOFile","Processing buffer (fileStart: "+t.fileStart+")"),t.usedBytes=0,this.stream.insertBuffer(t),this.stream.logBufferLevel(),this.stream.initialized()?!0:(p.warn("ISOFile","Not ready to start parsing"),!1))};c.prototype.appendBuffer=function(t,e){var i;if(this.checkBuffer(t))return this.parse(),this.moovStartFound&&!this.moovStartSent&&(this.moovStartSent=!0,this.onMoovStart&&this.onMoovStart()),this.moov?(this.sampleListBuilt||(this.buildSampleLists(),this.sampleListBuilt=!0),this.updateSampleLists(),this.onReady&&!this.readySent&&(this.readySent=!0,this.onReady(this.getInfo())),this.processSamples(e),this.nextSeekPosition?(i=this.nextSeekPosition,this.nextSeekPosition=void 0):i=this.nextParsePosition,this.stream.getEndFilePositionAfter&&(i=this.stream.getEndFilePositionAfter(i))):this.nextParsePosition?i=this.nextParsePosition:i=0,this.sidx&&this.onSidx&&!this.sidxSent&&(this.onSidx(this.sidx),this.sidxSent=!0),this.meta&&(this.flattenItemInfo&&!this.itemListBuilt&&(this.flattenItemInfo(),this.itemListBuilt=!0),this.processItems&&this.processItems(this.onItem)),this.stream.cleanBuffers&&(p.info("ISOFile","Done processing buffer (fileStart: "+t.fileStart+") - next buffer to fetch should have a fileStart position of "+i),this.stream.logBufferLevel(),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0),p.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize())),i};c.prototype.getInfo=function(){var t,e,i={},r,n,a,o,h=new Date("1904-01-01T00:00:00Z").getTime();if(this.moov)for(i.hasMoov=!0,i.duration=this.moov.mvhd.duration,i.timescale=this.moov.mvhd.timescale,i.isFragmented=this.moov.mvex!=null,i.isFragmented&&this.moov.mvex.mehd&&(i.fragment_duration=this.moov.mvex.mehd.fragment_duration),i.isProgressive=this.isProgressive,i.hasIOD=this.moov.iods!=null,i.brands=[],i.brands.push(this.ftyp.major_brand),i.brands=i.brands.concat(this.ftyp.compatible_brands),i.created=new Date(h+this.moov.mvhd.creation_time*1e3),i.modified=new Date(h+this.moov.mvhd.modification_time*1e3),i.tracks=[],i.audioTracks=[],i.videoTracks=[],i.subtitleTracks=[],i.metadataTracks=[],i.hintTracks=[],i.otherTracks=[],t=0;t<this.moov.traks.length;t++){if(r=this.moov.traks[t],o=r.mdia.minf.stbl.stsd.entries[0],n={},i.tracks.push(n),n.id=r.tkhd.track_id,n.name=r.mdia.hdlr.name,n.references=[],r.tref)for(e=0;e<r.tref.boxes.length;e++)a={},n.references.push(a),a.type=r.tref.boxes[e].type,a.track_ids=r.tref.boxes[e].track_ids;r.edts&&(n.edits=r.edts.elst.entries),n.created=new Date(h+r.tkhd.creation_time*1e3),n.modified=new Date(h+r.tkhd.modification_time*1e3),n.movie_duration=r.tkhd.duration,n.movie_timescale=i.timescale,n.layer=r.tkhd.layer,n.alternate_group=r.tkhd.alternate_group,n.volume=r.tkhd.volume,n.matrix=r.tkhd.matrix,n.track_width=r.tkhd.width/(1<<16),n.track_height=r.tkhd.height/(1<<16),n.timescale=r.mdia.mdhd.timescale,n.cts_shift=r.mdia.minf.stbl.cslg,n.duration=r.mdia.mdhd.duration,n.samples_duration=r.samples_duration,n.codec=o.getCodec(),n.kind=r.udta&&r.udta.kinds.length?r.udta.kinds[0]:{schemeURI:"",value:""},n.language=r.mdia.elng?r.mdia.elng.extended_language:r.mdia.mdhd.languageString,n.nb_samples=r.samples.length,n.size=r.samples_size,n.bitrate=n.size*8*n.timescale/n.samples_duration,o.isAudio()?(n.type="audio",i.audioTracks.push(n),n.audio={},n.audio.sample_rate=o.getSampleRate(),n.audio.channel_count=o.getChannelCount(),n.audio.sample_size=o.getSampleSize()):o.isVideo()?(n.type="video",i.videoTracks.push(n),n.video={},n.video.width=o.getWidth(),n.video.height=o.getHeight()):o.isSubtitle()?(n.type="subtitles",i.subtitleTracks.push(n)):o.isHint()?(n.type="metadata",i.hintTracks.push(n)):o.isMetadata()?(n.type="metadata",i.metadataTracks.push(n)):(n.type="metadata",i.otherTracks.push(n))}else i.hasMoov=!1;if(i.mime="",i.hasMoov&&i.tracks){for(i.videoTracks&&i.videoTracks.length>0?i.mime+='video/mp4; codecs="':i.audioTracks&&i.audioTracks.length>0?i.mime+='audio/mp4; codecs="':i.mime+='application/mp4; codecs="',t=0;t<i.tracks.length;t++)t!==0&&(i.mime+=","),i.mime+=i.tracks[t].codec;i.mime+='"; profiles="',i.mime+=this.ftyp.compatible_brands.join(),i.mime+='"'}return i};c.prototype.processSamples=function(t){var e,i;if(this.sampleProcessingStarted){if(this.isFragmentationInitialized&&this.onSegment!==null)for(e=0;e<this.fragmentedTracks.length;e++){var r=this.fragmentedTracks[e];for(i=r.trak;i.nextSample<i.samples.length&&this.sampleProcessingStarted;){p.debug("ISOFile","Creating media fragment on track #"+r.id+" for sample "+i.nextSample);var n=this.createFragment(r.id,i.nextSample,r.segmentStream);if(n)r.segmentStream=n,i.nextSample++;else break;if((i.nextSample%r.nb_samples===0||t||i.nextSample>=i.samples.length)&&(p.info("ISOFile","Sending fragmented data on track #"+r.id+" for samples ["+Math.max(0,i.nextSample-r.nb_samples)+","+(i.nextSample-1)+"]"),p.info("ISOFile","Sample data size in memory: "+this.getAllocatedSampleDataSize()),this.onSegment&&this.onSegment(r.id,r.user,r.segmentStream.buffer,i.nextSample,t||i.nextSample>=i.samples.length),r.segmentStream=null,r!==this.fragmentedTracks[e]))break}}if(this.onSamples!==null)for(e=0;e<this.extractedTracks.length;e++){var a=this.extractedTracks[e];for(i=a.trak;i.nextSample<i.samples.length&&this.sampleProcessingStarted;){p.debug("ISOFile","Exporting on track #"+a.id+" sample #"+i.nextSample);var o=this.getSample(i,i.nextSample);if(o)i.nextSample++,a.samples.push(o);else break;if((i.nextSample%a.nb_samples===0||i.nextSample>=i.samples.length)&&(p.debug("ISOFile","Sending samples on track #"+a.id+" for sample "+i.nextSample),this.onSamples&&this.onSamples(a.id,a.user,a.samples),a.samples=[],a!==this.extractedTracks[e]))break}}}};c.prototype.getBox=function(t){var e=this.getBoxes(t,!0);return e.length?e[0]:null};c.prototype.getBoxes=function(t,e){var i=[];return c._sweep.call(this,t,i,e),i};c._sweep=function(t,e,i){this.type&&this.type==t&&e.push(this);for(var r in this.boxes){if(e.length&&i)return;c._sweep.call(this.boxes[r],t,e,i)}};c.prototype.getTrackSamplesInfo=function(t){var e=this.getTrackById(t);if(e)return e.samples};c.prototype.getTrackSample=function(t,e){var i=this.getTrackById(t),r=this.getSample(i,e);return r};c.prototype.releaseUsedSamples=function(t,e){var i=0,r=this.getTrackById(t);r.lastValidSample||(r.lastValidSample=0);for(var n=r.lastValidSample;n<e;n++)i+=this.releaseSample(r,n);p.info("ISOFile","Track #"+t+" released samples up to "+e+" (released size: "+i+", remaining: "+this.samplesDataSize+")"),r.lastValidSample=e};c.prototype.start=function(){this.sampleProcessingStarted=!0,this.processSamples(!1)};c.prototype.stop=function(){this.sampleProcessingStarted=!1};c.prototype.flush=function(){p.info("ISOFile","Flushing remaining samples"),this.updateSampleLists(),this.processSamples(!0),this.stream.cleanBuffers(),this.stream.logBufferLevel(!0)};c.prototype.seekTrack=function(t,e,i){var r,n,a=1/0,o=0,h=0,f;if(i.samples.length===0)return p.info("ISOFile","No sample in track, cannot seek! Using time "+p.getDurationString(0,1)+" and offset: 0"),{offset:0,time:0};for(r=0;r<i.samples.length;r++){if(n=i.samples[r],r===0)h=0,f=n.timescale;else if(n.cts>t*n.timescale){h=r-1;break}e&&n.is_sync&&(o=r)}for(e&&(h=o),t=i.samples[h].cts,i.nextSample=h;i.samples[h].alreadyRead===i.samples[h].size&&i.samples[h+1];)h++;return a=i.samples[h].offset+i.samples[h].alreadyRead,p.info("ISOFile","Seeking to "+(e?"RAP":"")+" sample #"+i.nextSample+" on track "+i.tkhd.track_id+", time "+p.getDurationString(t,f)+" and offset: "+a),{offset:a,time:t/f}};c.prototype.seek=function(t,e){var i=this.moov,r,n,a,o={offset:1/0,time:1/0};if(this.moov){for(a=0;a<i.traks.length;a++)r=i.traks[a],n=this.seekTrack(t,e,r),n.offset<o.offset&&(o.offset=n.offset),n.time<o.time&&(o.time=n.time);return p.info("ISOFile","Seeking at time "+p.getDurationString(o.time,1)+" needs a buffer with a fileStart position of "+o.offset),o.offset===1/0?o={offset:this.nextParsePosition,time:0}:o.offset=this.stream.getEndFilePositionAfter(o.offset),p.info("ISOFile","Adjusted seek position (after checking data already in buffer): "+o.offset),o}else throw"Cannot seek: moov not received!"};c.prototype.equal=function(t){for(var e=0;e<this.boxes.length&&e<t.boxes.length;){var i=this.boxes[e],r=t.boxes[e];if(!s.boxEqual(i,r))return!1;e++}return!0};typeof S<"u"&&(S.ISOFile=c);c.prototype.lastBoxStartPosition=0;c.prototype.parsingMdat=null;c.prototype.nextParsePosition=0;c.prototype.discardMdatData=!1;c.prototype.processIncompleteBox=function(t){var e,i,r;return t.type==="mdat"?(e=new s[t.type+"Box"](t.size),this.parsingMdat=e,this.boxes.push(e),this.mdats.push(e),e.start=t.start,e.hdr_size=t.hdr_size,this.stream.addUsedBytes(e.hdr_size),this.lastBoxStartPosition=e.start+e.size,r=this.stream.seek(e.start+e.size,!1,this.discardMdatData),r?(this.parsingMdat=null,!0):(this.moovStartFound?this.nextParsePosition=this.stream.findEndContiguousBuf():this.nextParsePosition=e.start+e.size,!1)):(t.type==="moov"&&(this.moovStartFound=!0,this.mdats.length===0&&(this.isProgressive=!0)),i=this.stream.mergeNextBuffer?this.stream.mergeNextBuffer():!1,i?(this.nextParsePosition=this.stream.getEndPosition(),!0):(t.type?this.moovStartFound?this.nextParsePosition=this.stream.getEndPosition():this.nextParsePosition=this.stream.getPosition()+t.size:this.nextParsePosition=this.stream.getEndPosition(),!1))};c.prototype.hasIncompleteMdat=function(){return this.parsingMdat!==null};c.prototype.processIncompleteMdat=function(){var t,e;return t=this.parsingMdat,e=this.stream.seek(t.start+t.size,!1,this.discardMdatData),e?(p.debug("ISOFile","Found 'mdat' end in buffered data"),this.parsingMdat=null,!0):(this.nextParsePosition=this.stream.findEndContiguousBuf(),!1)};c.prototype.restoreParsePosition=function(){return this.stream.seek(this.lastBoxStartPosition,!0,this.discardMdatData)};c.prototype.saveParsePosition=function(){this.lastBoxStartPosition=this.stream.getPosition()};c.prototype.updateUsedBytes=function(t,e){this.stream.addUsedBytes&&(t.type==="mdat"?(this.stream.addUsedBytes(t.hdr_size),this.discardMdatData&&this.stream.addUsedBytes(t.size-t.hdr_size)):this.stream.addUsedBytes(t.size))};c.prototype.add=s.Box.prototype.add;c.prototype.addBox=s.Box.prototype.addBox;c.prototype.init=function(t){var e=t||{},i=this.add("ftyp").set("major_brand",e.brands&&e.brands[0]||"iso4").set("minor_version",0).set("compatible_brands",e.brands||["iso4"]),r=this.add("moov");return r.add("mvhd").set("timescale",e.timescale||600).set("rate",e.rate||1<<16).set("creation_time",0).set("modification_time",0).set("duration",e.duration||0).set("volume",e.width?0:256).set("matrix",[1<<16,0,0,0,1<<16,0,0,0,1073741824]).set("next_track_id",1),r.add("mvex"),this};c.prototype.addTrack=function(t){this.moov||this.init(t);var e=t||{};e.width=e.width||320,e.height=e.height||320,e.id=e.id||this.moov.mvhd.next_track_id,e.type=e.type||"avc1";var i=this.moov.add("trak");this.moov.mvhd.next_track_id=e.id+1,i.add("tkhd").set("flags",s.TKHD_FLAG_ENABLED|s.TKHD_FLAG_IN_MOVIE|s.TKHD_FLAG_IN_PREVIEW).set("creation_time",0).set("modification_time",0).set("track_id",e.id).set("duration",e.duration||0).set("layer",e.layer||0).set("alternate_group",0).set("volume",1).set("matrix",[0,0,0,0,0,0,0,0,0]).set("width",e.width<<16).set("height",e.height<<16);var r=i.add("mdia");r.add("mdhd").set("creation_time",0).set("modification_time",0).set("timescale",e.timescale||1).set("duration",e.media_duration||0).set("language",e.language||"und"),r.add("hdlr").set("handler",e.hdlr||"vide").set("name",e.name||"Track created with MP4Box.js"),r.add("elng").set("extended_language",e.language||"fr-FR");var n=r.add("minf");if(s[e.type+"SampleEntry"]!==void 0){var a=new s[e.type+"SampleEntry"];a.data_reference_index=1;var o="";for(var h in s.sampleEntryCodes)for(var f=s.sampleEntryCodes[h],d=0;d<f.length;d++)if(f.indexOf(e.type)>-1){o=h;break}switch(o){case"Visual":if(n.add("vmhd").set("graphicsmode",0).set("opcolor",[0,0,0]),a.set("width",e.width).set("height",e.height).set("horizresolution",72<<16).set("vertresolution",72<<16).set("frame_count",1).set("compressorname",e.type+" Compressor").set("depth",24),e.avcDecoderConfigRecord){var u=new s.avcCBox,y=new x(e.avcDecoderConfigRecord);u.parse(y),a.addBox(u)}break;case"Audio":n.add("smhd").set("balance",e.balance||0),a.set("channel_count",e.channel_count||2).set("samplesize",e.samplesize||16).set("samplerate",e.samplerate||1<<16);break;case"Hint":n.add("hmhd");break;case"Subtitle":switch(n.add("sthd"),e.type){case"stpp":a.set("namespace",e.namespace||"nonamespace").set("schema_location",e.schema_location||"").set("auxiliary_mime_types",e.auxiliary_mime_types||"");break}break;case"Metadata":n.add("nmhd");break;case"System":n.add("nmhd");break;default:n.add("nmhd");break}e.description&&a.addBox(e.description),e.description_boxes&&e.description_boxes.forEach(function(_){a.addBox(_)}),n.add("dinf").add("dref").addEntry(new s["url Box"]().set("flags",1));var g=n.add("stbl");return g.add("stsd").addEntry(a),g.add("stts").set("sample_counts",[]).set("sample_deltas",[]),g.add("stsc").set("first_chunk",[]).set("samples_per_chunk",[]).set("sample_description_index",[]),g.add("stco").set("chunk_offsets",[]),g.add("stsz").set("sample_sizes",[]),this.moov.mvex.add("trex").set("track_id",e.id).set("default_sample_description_index",e.default_sample_description_index||1).set("default_sample_duration",e.default_sample_duration||0).set("default_sample_size",e.default_sample_size||0).set("default_sample_flags",e.default_sample_flags||0),this.buildTrakSampleLists(i),e.id}};s.Box.prototype.computeSize=function(t){var e=t||new l;e.endianness=l.BIG_ENDIAN,this.write(e)};c.prototype.addSample=function(t,e,i){var r=i||{},n={},a=this.getTrackById(t);if(a!==null){n.number=a.samples.length,n.track_id=a.tkhd.track_id,n.timescale=a.mdia.mdhd.timescale,n.description_index=r.sample_description_index?r.sample_description_index-1:0,n.description=a.mdia.minf.stbl.stsd.entries[n.description_index],n.data=e,n.size=e.byteLength,n.alreadyRead=n.size,n.duration=r.duration||1,n.cts=r.cts||0,n.dts=r.dts||0,n.is_sync=r.is_sync||!1,n.is_leading=r.is_leading||0,n.depends_on=r.depends_on||0,n.is_depended_on=r.is_depended_on||0,n.has_redundancy=r.has_redundancy||0,n.degradation_priority=r.degradation_priority||0,n.offset=0,n.subsamples=r.subsamples,a.samples.push(n),a.samples_size+=n.size,a.samples_duration+=n.duration,a.first_dts||(a.first_dts=r.dts),this.processSamples();var o=this.createSingleSampleMoof(n);return this.addBox(o),o.computeSize(),o.trafs[0].truns[0].data_offset=o.size+8,this.add("mdat").data=new Uint8Array(e),n}};c.prototype.createSingleSampleMoof=function(t){var e=0;t.is_sync?e=1<<25:e=1<<16;var i=new s.moofBox;i.add("mfhd").set("sequence_number",this.nextMoofNumber),this.nextMoofNumber++;var r=i.add("traf"),n=this.getTrackById(t.track_id);return r.add("tfhd").set("track_id",t.track_id).set("flags",s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),r.add("tfdt").set("baseMediaDecodeTime",t.dts-(n.first_dts||0)),r.add("trun").set("flags",s.TRUN_FLAGS_DATA_OFFSET|s.TRUN_FLAGS_DURATION|s.TRUN_FLAGS_SIZE|s.TRUN_FLAGS_FLAGS|s.TRUN_FLAGS_CTS_OFFSET).set("data_offset",0).set("first_sample_flags",0).set("sample_count",1).set("sample_duration",[t.duration]).set("sample_size",[t.size]).set("sample_flags",[e]).set("sample_composition_time_offset",[t.cts-t.dts]),i};c.prototype.lastMoofIndex=0;c.prototype.samplesDataSize=0;c.prototype.resetTables=function(){var t,e,i,r,n,a,o,h;for(this.initial_duration=this.moov.mvhd.duration,this.moov.mvhd.duration=0,t=0;t<this.moov.traks.length;t++){e=this.moov.traks[t],e.tkhd.duration=0,e.mdia.mdhd.duration=0,i=e.mdia.minf.stbl.stco||e.mdia.minf.stbl.co64,i.chunk_offsets=[],r=e.mdia.minf.stbl.stsc,r.first_chunk=[],r.samples_per_chunk=[],r.sample_description_index=[],n=e.mdia.minf.stbl.stsz||e.mdia.minf.stbl.stz2,n.sample_sizes=[],a=e.mdia.minf.stbl.stts,a.sample_counts=[],a.sample_deltas=[],o=e.mdia.minf.stbl.ctts,o&&(o.sample_counts=[],o.sample_offsets=[]),h=e.mdia.minf.stbl.stss;var f=e.mdia.minf.stbl.boxes.indexOf(h);f!=-1&&(e.mdia.minf.stbl.boxes[f]=null)}};c.initSampleGroups=function(t,e,i,r,n){var a,o,h,f,d;function u(y,g,_){this.grouping_type=y,this.grouping_type_parameter=g,this.sbgp=_,this.last_sample_in_run=-1,this.entry_index=-1}for(e&&(e.sample_groups_info=[]),t.sample_groups_info||(t.sample_groups_info=[]),o=0;o<i.length;o++){for(d=i[o].grouping_type+"/"+i[o].grouping_type_parameter,f=new u(i[o].grouping_type,i[o].grouping_type_parameter,i[o]),e&&(e.sample_groups_info[d]=f),t.sample_groups_info[d]||(t.sample_groups_info[d]=f),a=0;a<r.length;a++)r[a].grouping_type===i[o].grouping_type&&(f.description=r[a],f.description.used=!0);if(n)for(a=0;a<n.length;a++)n[a].grouping_type===i[o].grouping_type&&(f.fragment_description=n[a],f.fragment_description.used=!0,f.is_fragment=!0)}if(e){if(n)for(o=0;o<n.length;o++)!n[o].used&&n[o].version>=2&&(d=n[o].grouping_type+"/0",f=new u(n[o].grouping_type,0),f.is_fragment=!0,e.sample_groups_info[d]||(e.sample_groups_info[d]=f))}else for(o=0;o<r.length;o++)!r[o].used&&r[o].version>=2&&(d=r[o].grouping_type+"/0",f=new u(r[o].grouping_type,0),t.sample_groups_info[d]||(t.sample_groups_info[d]=f))};c.setSampleGroupProperties=function(t,e,i,r){var n,a;e.sample_groups=[];for(n in r)if(e.sample_groups[n]={},e.sample_groups[n].grouping_type=r[n].grouping_type,e.sample_groups[n].grouping_type_parameter=r[n].grouping_type_parameter,i>=r[n].last_sample_in_run&&(r[n].last_sample_in_run<0&&(r[n].last_sample_in_run=0),r[n].entry_index++,r[n].entry_index<=r[n].sbgp.entries.length-1&&(r[n].last_sample_in_run+=r[n].sbgp.entries[r[n].entry_index].sample_count)),r[n].entry_index<=r[n].sbgp.entries.length-1?e.sample_groups[n].group_description_index=r[n].sbgp.entries[r[n].entry_index].group_description_index:e.sample_groups[n].group_description_index=-1,e.sample_groups[n].group_description_index!==0){var o;r[n].fragment_description?o=r[n].fragment_description:o=r[n].description,e.sample_groups[n].group_description_index>0?(e.sample_groups[n].group_description_index>65535?a=(e.sample_groups[n].group_description_index>>16)-1:a=e.sample_groups[n].group_description_index-1,o&&a>=0&&(e.sample_groups[n].description=o.entries[a])):o&&o.version>=2&&o.default_group_description_index>0&&(e.sample_groups[n].description=o.entries[o.default_group_description_index-1])}};c.process_sdtp=function(t,e,i){e&&(t?(e.is_leading=t.is_leading[i],e.depends_on=t.sample_depends_on[i],e.is_depended_on=t.sample_is_depended_on[i],e.has_redundancy=t.sample_has_redundancy[i]):(e.is_leading=0,e.depends_on=0,e.is_depended_on=0,e.has_redundancy=0))};c.prototype.buildSampleLists=function(){var t,e;for(t=0;t<this.moov.traks.length;t++)e=this.moov.traks[t],this.buildTrakSampleLists(e)};c.prototype.buildTrakSampleLists=function(t){var e,i,r,n,a,o,h,f,d,u,y,g,_,b,U,T,O,j,I,R,q,Q,nt,Ze,L,$;if(t.samples=[],t.samples_duration=0,t.samples_size=0,r=t.mdia.minf.stbl.stco||t.mdia.minf.stbl.co64,n=t.mdia.minf.stbl.stsc,a=t.mdia.minf.stbl.stsz||t.mdia.minf.stbl.stz2,o=t.mdia.minf.stbl.stts,h=t.mdia.minf.stbl.ctts,f=t.mdia.minf.stbl.stss,d=t.mdia.minf.stbl.stsd,u=t.mdia.minf.stbl.subs,_=t.mdia.minf.stbl.stdp,y=t.mdia.minf.stbl.sbgps,g=t.mdia.minf.stbl.sgpds,I=-1,R=-1,q=-1,Q=-1,nt=0,L=0,$=0,c.initSampleGroups(t,null,y,g),!(typeof a>"u")){for(e=0;e<a.sample_sizes.length;e++){var m={};m.number=e,m.track_id=t.tkhd.track_id,m.timescale=t.mdia.mdhd.timescale,m.alreadyRead=0,t.samples[e]=m,m.size=a.sample_sizes[e],t.samples_size+=m.size,e===0?(U=1,b=0,m.chunk_index=U,m.chunk_run_index=b,j=n.samples_per_chunk[b],O=0,b+1<n.first_chunk.length?T=n.first_chunk[b+1]-1:T=1/0):e<j?(m.chunk_index=U,m.chunk_run_index=b):(U++,m.chunk_index=U,O=0,U<=T||(b++,b+1<n.first_chunk.length?T=n.first_chunk[b+1]-1:T=1/0),m.chunk_run_index=b,j+=n.samples_per_chunk[b]),m.description_index=n.sample_description_index[m.chunk_run_index]-1,m.description=d.entries[m.description_index],m.offset=r.chunk_offsets[m.chunk_index-1]+O,O+=m.size,e>I&&(R++,I<0&&(I=0),I+=o.sample_counts[R]),e>0?(t.samples[e-1].duration=o.sample_deltas[R],t.samples_duration+=t.samples[e-1].duration,m.dts=t.samples[e-1].dts+t.samples[e-1].duration):m.dts=0,h?(e>=q&&(Q++,q<0&&(q=0),q+=h.sample_counts[Q]),m.cts=t.samples[e].dts+h.sample_offsets[Q]):m.cts=m.dts,f?(e==f.sample_numbers[nt]-1?(m.is_sync=!0,nt++):(m.is_sync=!1,m.degradation_priority=0),u&&u.entries[L].sample_delta+$==e+1&&(m.subsamples=u.entries[L].subsamples,$+=u.entries[L].sample_delta,L++)):m.is_sync=!0,c.process_sdtp(t.mdia.minf.stbl.sdtp,m,m.number),_?m.degradation_priority=_.priority[e]:m.degradation_priority=0,u&&u.entries[L].sample_delta+$==e&&(m.subsamples=u.entries[L].subsamples,$+=u.entries[L].sample_delta),(y.length>0||g.length>0)&&c.setSampleGroupProperties(t,m,e,t.sample_groups_info)}e>0&&(t.samples[e-1].duration=Math.max(t.mdia.mdhd.duration-t.samples[e-1].dts,0),t.samples_duration+=t.samples[e-1].duration)}};c.prototype.updateSampleLists=function(){var t,e,i,r,n,a,o,h,f,d,u,y,g,_,b;if(this.moov!==void 0){for(;this.lastMoofIndex<this.moofs.length;)if(f=this.moofs[this.lastMoofIndex],this.lastMoofIndex++,f.type=="moof")for(d=f,t=0;t<d.trafs.length;t++){for(u=d.trafs[t],y=this.getTrackById(u.tfhd.track_id),g=this.getTrexById(u.tfhd.track_id),u.tfhd.flags&s.TFHD_FLAG_SAMPLE_DESC?r=u.tfhd.default_sample_description_index:r=g?g.default_sample_description_index:1,u.tfhd.flags&s.TFHD_FLAG_SAMPLE_DUR?n=u.tfhd.default_sample_duration:n=g?g.default_sample_duration:0,u.tfhd.flags&s.TFHD_FLAG_SAMPLE_SIZE?a=u.tfhd.default_sample_size:a=g?g.default_sample_size:0,u.tfhd.flags&s.TFHD_FLAG_SAMPLE_FLAGS?o=u.tfhd.default_sample_flags:o=g?g.default_sample_flags:0,u.sample_number=0,u.sbgps.length>0&&c.initSampleGroups(y,u,u.sbgps,y.mdia.minf.stbl.sgpds,u.sgpds),e=0;e<u.truns.length;e++){var U=u.truns[e];for(i=0;i<U.sample_count;i++){_={},_.moof_number=this.lastMoofIndex,_.number_in_traf=u.sample_number,u.sample_number++,_.number=y.samples.length,u.first_sample_index=y.samples.length,y.samples.push(_),_.track_id=y.tkhd.track_id,_.timescale=y.mdia.mdhd.timescale,_.description_index=r-1,_.description=y.mdia.minf.stbl.stsd.entries[_.description_index],_.size=a,U.flags&s.TRUN_FLAGS_SIZE&&(_.size=U.sample_size[i]),y.samples_size+=_.size,_.duration=n,U.flags&s.TRUN_FLAGS_DURATION&&(_.duration=U.sample_duration[i]),y.samples_duration+=_.duration,y.first_traf_merged||i>0?_.dts=y.samples[y.samples.length-2].dts+y.samples[y.samples.length-2].duration:(u.tfdt?_.dts=u.tfdt.baseMediaDecodeTime:_.dts=0,y.first_traf_merged=!0),_.cts=_.dts,U.flags&s.TRUN_FLAGS_CTS_OFFSET&&(_.cts=_.dts+U.sample_composition_time_offset[i]),b=o,U.flags&s.TRUN_FLAGS_FLAGS?b=U.sample_flags[i]:i===0&&U.flags&s.TRUN_FLAGS_FIRST_FLAG&&(b=U.first_sample_flags),_.is_sync=!(b>>16&1),_.is_leading=b>>26&3,_.depends_on=b>>24&3,_.is_depended_on=b>>22&3,_.has_redundancy=b>>20&3,_.degradation_priority=b&65535;var T=!!(u.tfhd.flags&s.TFHD_FLAG_BASE_DATA_OFFSET),O=!!(u.tfhd.flags&s.TFHD_FLAG_DEFAULT_BASE_IS_MOOF),j=!!(U.flags&s.TRUN_FLAGS_DATA_OFFSET),I=0;T?I=u.tfhd.base_data_offset:O||e===0?I=d.start:I=h,e===0&&i===0?j?_.offset=I+U.data_offset:_.offset=I:_.offset=h,h=_.offset+_.size,(u.sbgps.length>0||u.sgpds.length>0||y.mdia.minf.stbl.sbgps.length>0||y.mdia.minf.stbl.sgpds.length>0)&&c.setSampleGroupProperties(y,_,_.number_in_traf,u.sample_groups_info)}}if(u.subs){y.has_fragment_subsamples=!0;var R=u.first_sample_index;for(e=0;e<u.subs.entries.length;e++)R+=u.subs.entries[e].sample_delta,_=y.samples[R-1],_.subsamples=u.subs.entries[e].subsamples}}}};c.prototype.getSample=function(t,e){var i,r=t.samples[e];if(!this.moov)return null;if(!r.data)r.data=new Uint8Array(r.size),r.alreadyRead=0,this.samplesDataSize+=r.size,p.debug("ISOFile","Allocating sample #"+e+" on track #"+t.tkhd.track_id+" of size "+r.size+" (total: "+this.samplesDataSize+")");else if(r.alreadyRead==r.size)return r;for(;;){var n=this.stream.findPosition(!0,r.offset+r.alreadyRead,!1);if(n>-1){i=this.stream.buffers[n];var a=i.byteLength-(r.offset+r.alreadyRead-i.fileStart);if(r.size-r.alreadyRead<=a)return p.debug("ISOFile","Getting sample #"+e+" data (alreadyRead: "+r.alreadyRead+" offset: "+(r.offset+r.alreadyRead-i.fileStart)+" read size: "+(r.size-r.alreadyRead)+" full size: "+r.size+")"),l.memcpy(r.data.buffer,r.alreadyRead,i,r.offset+r.alreadyRead-i.fileStart,r.size-r.alreadyRead),i.usedBytes+=r.size-r.alreadyRead,this.stream.logBufferLevel(),r.alreadyRead=r.size,r;if(a===0)return null;p.debug("ISOFile","Getting sample #"+e+" partial data (alreadyRead: "+r.alreadyRead+" offset: "+(r.offset+r.alreadyRead-i.fileStart)+" read size: "+a+" full size: "+r.size+")"),l.memcpy(r.data.buffer,r.alreadyRead,i,r.offset+r.alreadyRead-i.fileStart,a),r.alreadyRead+=a,i.usedBytes+=a,this.stream.logBufferLevel()}else return null}};c.prototype.releaseSample=function(t,e){var i=t.samples[e];return i.data?(this.samplesDataSize-=i.size,i.data=null,i.alreadyRead=0,i.size):0};c.prototype.getAllocatedSampleDataSize=function(){return this.samplesDataSize};c.prototype.getCodecs=function(){var t,e="";for(t=0;t<this.moov.traks.length;t++){var i=this.moov.traks[t];t>0&&(e+=","),e+=i.mdia.minf.stbl.stsd.entries[0].getCodec()}return e};c.prototype.getTrexById=function(t){var e;if(!this.moov||!this.moov.mvex)return null;for(e=0;e<this.moov.mvex.trexs.length;e++){var i=this.moov.mvex.trexs[e];if(i.track_id==t)return i}return null};c.prototype.getTrackById=function(t){if(this.moov===void 0)return null;for(var e=0;e<this.moov.traks.length;e++){var i=this.moov.traks[e];if(i.tkhd.track_id==t)return i}return null};c.prototype.items=[];c.prototype.itemsDataSize=0;c.prototype.flattenItemInfo=function(){var t=this.items,e,i,r,n=this.meta;if(n!=null&&n.hdlr!==void 0&&n.iinf!==void 0){for(e=0;e<n.iinf.item_infos.length;e++)r={},r.id=n.iinf.item_infos[e].item_ID,t[r.id]=r,r.ref_to=[],r.name=n.iinf.item_infos[e].item_name,n.iinf.item_infos[e].protection_index>0&&(r.protection=n.ipro.protections[n.iinf.item_infos[e].protection_index-1]),n.iinf.item_infos[e].item_type?r.type=n.iinf.item_infos[e].item_type:r.type="mime",r.content_type=n.iinf.item_infos[e].content_type,r.content_encoding=n.iinf.item_infos[e].content_encoding;if(n.iloc)for(e=0;e<n.iloc.items.length;e++){var a,o=n.iloc.items[e];switch(r=t[o.item_ID],o.data_reference_index!==0&&(p.warn("Item storage with reference to other files: not supported"),r.source=n.dinf.boxes[o.data_reference_index-1]),o.construction_method){case 0:break;case 1:p.warn("Item storage with construction_method : not supported");break;case 2:p.warn("Item storage with construction_method : not supported");break}for(r.extents=[],r.size=0,i=0;i<o.extents.length;i++)r.extents[i]={},r.extents[i].offset=o.extents[i].extent_offset+o.base_offset,r.extents[i].length=o.extents[i].extent_length,r.extents[i].alreadyRead=0,r.size+=r.extents[i].length}if(n.pitm&&(t[n.pitm.item_id].primary=!0),n.iref)for(e=0;e<n.iref.references.length;e++){var h=n.iref.references[e];for(i=0;i<h.references.length;i++)t[h.from_item_ID].ref_to.push({type:h.type,id:h.references[i]})}if(n.iprp)for(var f=0;f<n.iprp.ipmas.length;f++){var d=n.iprp.ipmas[f];for(e=0;e<d.associations.length;e++){var u=d.associations[e];for(r=t[u.id],r.properties===void 0&&(r.properties={},r.properties.boxes=[]),i=0;i<u.props.length;i++){var y=u.props[i];if(y.property_index>0&&y.property_index-1<n.iprp.ipco.boxes.length){var g=n.iprp.ipco.boxes[y.property_index-1];r.properties[g.type]=g,r.properties.boxes.push(g)}}}}}};c.prototype.getItem=function(t){var e,i;if(!this.meta)return null;if(i=this.items[t],!i.data&&i.size)i.data=new Uint8Array(i.size),i.alreadyRead=0,this.itemsDataSize+=i.size,p.debug("ISOFile","Allocating item #"+t+" of size "+i.size+" (total: "+this.itemsDataSize+")");else if(i.alreadyRead===i.size)return i;for(var r=0;r<i.extents.length;r++){var n=i.extents[r];if(n.alreadyRead!==n.length){var a=this.stream.findPosition(!0,n.offset+n.alreadyRead,!1);if(a>-1){e=this.stream.buffers[a];var o=e.byteLength-(n.offset+n.alreadyRead-e.fileStart);if(n.length-n.alreadyRead<=o)p.debug("ISOFile","Getting item #"+t+" extent #"+r+" data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-e.fileStart)+" read size: "+(n.length-n.alreadyRead)+" full extent size: "+n.length+" full item size: "+i.size+")"),l.memcpy(i.data.buffer,i.alreadyRead,e,n.offset+n.alreadyRead-e.fileStart,n.length-n.alreadyRead),e.usedBytes+=n.length-n.alreadyRead,this.stream.logBufferLevel(),i.alreadyRead+=n.length-n.alreadyRead,n.alreadyRead=n.length;else return p.debug("ISOFile","Getting item #"+t+" extent #"+r+" partial data (alreadyRead: "+n.alreadyRead+" offset: "+(n.offset+n.alreadyRead-e.fileStart)+" read size: "+o+" full extent size: "+n.length+" full item size: "+i.size+")"),l.memcpy(i.data.buffer,i.alreadyRead,e,n.offset+n.alreadyRead-e.fileStart,o),n.alreadyRead+=o,i.alreadyRead+=o,e.usedBytes+=o,this.stream.logBufferLevel(),null}else return null}}return i.alreadyRead===i.size?i:null};c.prototype.releaseItem=function(t){var e=this.items[t];if(e.data){this.itemsDataSize-=e.size,e.data=null,e.alreadyRead=0;for(var i=0;i<e.extents.length;i++){var r=e.extents[i];r.alreadyRead=0}return e.size}else return 0};c.prototype.processItems=function(t){for(var e in this.items){var i=this.items[e];this.getItem(i.id),t&&!i.sent&&(t(i),i.sent=!0,i.data=null)}};c.prototype.hasItem=function(t){for(var e in this.items){var i=this.items[e];if(i.name===t)return i.id}return-1};c.prototype.getMetaHandler=function(){return this.meta?this.meta.hdlr.handler:null};c.prototype.getPrimaryItem=function(){return!this.meta||!this.meta.pitm?null:this.getItem(this.meta.pitm.item_id)};c.prototype.itemToFragmentedTrackFile=function(t){var e=t||{},i=null;if(e.itemId?i=this.getItem(e.itemId):i=this.getPrimaryItem(),i==null)return null;var r=new c;r.discardMdatData=!1;var n={type:i.type,description_boxes:i.properties.boxes};i.properties.ispe&&(n.width=i.properties.ispe.image_width,n.height=i.properties.ispe.image_height);var a=r.addTrack(n);return a?(r.addSample(a,i.data),r):null};c.prototype.write=function(t){for(var e=0;e<this.boxes.length;e++)this.boxes[e].write(t)};c.prototype.createFragment=function(t,e,i){var r=this.getTrackById(t),n=this.getSample(r,e);if(n==null)return n=r.samples[e],this.nextSeekPosition?this.nextSeekPosition=Math.min(n.offset+n.alreadyRead,this.nextSeekPosition):this.nextSeekPosition=r.samples[e].offset+n.alreadyRead,null;var a=i||new l;a.endianness=l.BIG_ENDIAN;var o=this.createSingleSampleMoof(n);o.write(a),o.trafs[0].truns[0].data_offset=o.size+8,p.debug("MP4Box","Adjusting data_offset with new value "+o.trafs[0].truns[0].data_offset),a.adjustUint32(o.trafs[0].truns[0].data_offset_position,o.trafs[0].truns[0].data_offset);var h=new s.mdatBox;return h.data=n.data,h.write(a),a};c.writeInitializationSegment=function(t,e,i,r){var n,a,o,h,f;p.debug("ISOFile","Generating initialization segment");var d=new l;d.endianness=l.BIG_ENDIAN,t.write(d);var u=e.add("mvex");for(i&&u.add("mehd").set("fragment_duration",i),n=0;n<e.traks.length;n++)u.add("trex").set("track_id",e.traks[n].tkhd.track_id).set("default_sample_description_index",1).set("default_sample_duration",r).set("default_sample_size",0).set("default_sample_flags",1<<16);return e.write(d),d.buffer};c.prototype.save=function(t){var e=new l;e.endianness=l.BIG_ENDIAN,this.write(e),e.save(t)};c.prototype.getBuffer=function(){var t=new l;return t.endianness=l.BIG_ENDIAN,this.write(t),t.buffer};c.prototype.initializeSegmentation=function(){var t,e,i,r,n,a;for(this.onSegment===null&&p.warn("MP4Box","No segmentation callback set!"),this.isFragmentationInitialized||(this.isFragmentationInitialized=!0,this.nextMoofNumber=0,this.resetTables()),r=[],t=0;t<this.fragmentedTracks.length;t++){var o=new s.moovBox;o.mvhd=this.moov.mvhd,o.boxes.push(o.mvhd),n=this.getTrackById(this.fragmentedTracks[t].id),o.boxes.push(n),o.traks.push(n),a={},a.id=n.tkhd.track_id,a.user=this.fragmentedTracks[t].user,a.buffer=c.writeInitializationSegment(this.ftyp,o,this.moov.mvex&&this.moov.mvex.mehd?this.moov.mvex.mehd.fragment_duration:void 0,this.moov.traks[t].samples.length>0?this.moov.traks[t].samples[0].duration:0),r.push(a)}return r};s.Box.prototype.printHeader=function(t){this.size+=8,this.size>k&&(this.size+=8),this.type==="uuid"&&(this.size+=16),t.log(t.indent+"size:"+this.size),t.log(t.indent+"type:"+this.type)};s.FullBox.prototype.printHeader=function(t){this.size+=4,s.Box.prototype.printHeader.call(this,t),t.log(t.indent+"version:"+this.version),t.log(t.indent+"flags:"+this.flags)};s.Box.prototype.print=function(t){this.printHeader(t)};s.ContainerBox.prototype.print=function(t){this.printHeader(t);for(var e=0;e<this.boxes.length;e++)if(this.boxes[e]){var i=t.indent;t.indent+=" ",this.boxes[e].print(t),t.indent=i}};c.prototype.print=function(t){t.indent="";for(var e=0;e<this.boxes.length;e++)this.boxes[e]&&this.boxes[e].print(t)};s.mvhdBox.prototype.print=function(t){s.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"timescale: "+this.timescale),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"rate: "+this.rate),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"next_track_id: "+this.next_track_id)};s.tkhdBox.prototype.print=function(t){s.FullBox.prototype.printHeader.call(this,t),t.log(t.indent+"creation_time: "+this.creation_time),t.log(t.indent+"modification_time: "+this.modification_time),t.log(t.indent+"track_id: "+this.track_id),t.log(t.indent+"duration: "+this.duration),t.log(t.indent+"volume: "+(this.volume>>8)),t.log(t.indent+"matrix: "+this.matrix.join(", ")),t.log(t.indent+"layer: "+this.layer),t.log(t.indent+"alternate_group: "+this.alternate_group),t.log(t.indent+"width: "+this.width),t.log(t.indent+"height: "+this.height)};var Et={};Et.createFile=function(t,e){var i=t!==void 0?t:!0,r=new c(e);return r.discardMdatData=!i,r};typeof S<"u"&&(S.createFile=Et.createFile)});var Mt=at(v=>{"use strict";var W=Symbol.for("react.element"),te=Symbol.for("react.portal"),ee=Symbol.for("react.fragment"),ie=Symbol.for("react.strict_mode"),re=Symbol.for("react.profiler"),se=Symbol.for("react.provider"),ne=Symbol.for("react.context"),ae=Symbol.for("react.forward_ref"),oe=Symbol.for("react.suspense"),he=Symbol.for("react.memo"),fe=Symbol.for("react.lazy"),It=Symbol.iterator;function le(t){return t===null||typeof t!="object"?null:(t=It&&t[It]||t["@@iterator"],typeof t=="function"?t:null)}var Tt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ct=Object.assign,Pt={};function V(t,e,i){this.props=t,this.context=e,this.refs=Pt,this.updater=i||Tt}V.prototype.isReactComponent={};V.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};V.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Lt(){}Lt.prototype=V.prototype;function lt(t,e,i){this.props=t,this.context=e,this.refs=Pt,this.updater=i||Tt}var dt=lt.prototype=new Lt;dt.constructor=lt;Ct(dt,V.prototype);dt.isPureReactComponent=!0;var zt=Array.isArray,kt=Object.prototype.hasOwnProperty,ut={current:null},Dt={key:!0,ref:!0,__self:!0,__source:!0};function Rt(t,e,i){var r,n={},a=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)kt.call(e,r)&&!Dt.hasOwnProperty(r)&&(n[r]=e[r]);var h=arguments.length-2;if(h===1)n.children=i;else if(1<h){for(var f=Array(h),d=0;d<h;d++)f[d]=arguments[d+2];n.children=f}if(t&&t.defaultProps)for(r in h=t.defaultProps,h)n[r]===void 0&&(n[r]=h[r]);return{$$typeof:W,type:t,key:a,ref:o,props:n,_owner:ut.current}}function de(t,e){return{$$typeof:W,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function pt(t){return typeof t=="object"&&t!==null&&t.$$typeof===W}function ue(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var Ft=/\/+/g;function ft(t,e){return typeof t=="object"&&t!==null&&t.key!=null?ue(""+t.key):e.toString(36)}function et(t,e,i,r,n){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case W:case te:o=!0}}if(o)return o=t,n=n(o),t=r===""?"."+ft(o,0):r,zt(n)?(i="",t!=null&&(i=t.replace(Ft,"$&/")+"/"),et(n,e,i,"",function(d){return d})):n!=null&&(pt(n)&&(n=de(n,i+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(Ft,"$&/")+"/")+t)),e.push(n)),1;if(o=0,r=r===""?".":r+":",zt(t))for(var h=0;h<t.length;h++){a=t[h];var f=r+ft(a,h);o+=et(a,e,i,f,n)}else if(f=le(t),typeof f=="function")for(t=f.call(t),h=0;!(a=t.next()).done;)a=a.value,f=r+ft(a,h++),o+=et(a,e,i,f,n);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function tt(t,e,i){if(t==null)return t;var r=[],n=0;return et(t,r,"","",function(a){return e.call(i,a,n++)}),r}function pe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var E={current:null},it={transition:null},ce={ReactCurrentDispatcher:E,ReactCurrentBatchConfig:it,ReactCurrentOwner:ut};v.Children={map:tt,forEach:function(t,e,i){tt(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return tt(t,function(){e++}),e},toArray:function(t){return tt(t,function(e){return e})||[]},only:function(t){if(!pt(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};v.Component=V;v.Fragment=ee;v.Profiler=re;v.PureComponent=lt;v.StrictMode=ie;v.Suspense=oe;v.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ce;v.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Ct({},t.props),n=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=ut.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var h=t.type.defaultProps;for(f in e)kt.call(e,f)&&!Dt.hasOwnProperty(f)&&(r[f]=e[f]===void 0&&h!==void 0?h[f]:e[f])}var f=arguments.length-2;if(f===1)r.children=i;else if(1<f){h=Array(f);for(var d=0;d<f;d++)h[d]=arguments[d+2];r.children=h}return{$$typeof:W,type:t.type,key:n,ref:a,props:r,_owner:o}};v.createContext=function(t){return t={$$typeof:ne,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:se,_context:t},t.Consumer=t};v.createElement=Rt;v.createFactory=function(t){var e=Rt.bind(null,t);return e.type=t,e};v.createRef=function(){return{current:null}};v.forwardRef=function(t){return{$$typeof:ae,render:t}};v.isValidElement=pt;v.lazy=function(t){return{$$typeof:fe,_payload:{_status:-1,_result:t},_init:pe}};v.memo=function(t,e){return{$$typeof:he,type:t,compare:e===void 0?null:e}};v.startTransition=function(t){var e=it.transition;it.transition={};try{t()}finally{it.transition=e}};v.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};v.useCallback=function(t,e){return E.current.useCallback(t,e)};v.useContext=function(t){return E.current.useContext(t)};v.useDebugValue=function(){};v.useDeferredValue=function(t){return E.current.useDeferredValue(t)};v.useEffect=function(t,e){return E.current.useEffect(t,e)};v.useId=function(){return E.current.useId()};v.useImperativeHandle=function(t,e,i){return E.current.useImperativeHandle(t,e,i)};v.useInsertionEffect=function(t,e){return E.current.useInsertionEffect(t,e)};v.useLayoutEffect=function(t,e){return E.current.useLayoutEffect(t,e)};v.useMemo=function(t,e){return E.current.useMemo(t,e)};v.useReducer=function(t,e,i){return E.current.useReducer(t,e,i)};v.useRef=function(t){return E.current.useRef(t)};v.useState=function(t){return E.current.useState(t)};v.useSyncExternalStore=function(t,e,i){return E.current.useSyncExternalStore(t,e,i)};v.useTransition=function(){return E.current.useTransition()};v.version="18.2.0"});var Y=at((ui,Nt)=>{"use strict";Nt.exports=Mt()});var K=class{canvas;canvasHeight;canvasWidth;queue;render;sync;last;constructor(e){this.canvas=e.canvas,this.queue=[],this.render=0,this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height}emit(e){if(this.sync||(this.sync=performance.now()-e.timestamp),this.last&&e.timestamp<=this.last){e.close();return}if(this.queue.length>0&&this.queue[this.queue.length-1].timestamp<=e.timestamp)this.queue.push(e);else{let r=0,n=this.queue.length;for(;r<n;){var i=r+n>>>1;this.queue[i].timestamp<e.timestamp?r=i+1:n=i}this.queue.splice(r,0,e)}this.render||(this.render=self.requestAnimationFrame(this.draw.bind(this)))}draw(e){let i=e-this.sync,r=this.queue[0];if(r.timestamp>=i){this.render=self.requestAnimationFrame(this.draw.bind(this));return}for(this.queue.shift();this.queue.length;){let a=this.queue[0];if(a.timestamp>i)break;r.close(),this.queue.shift(),r=a}let n=this.canvas.getContext("2d");this.canvas.height=this.canvasHeight,this.canvas.width=this.canvasWidth,n.canvas.height=this.canvasHeight,n.canvas.width=this.canvasWidth,n.drawImage(r,0,0,this.canvasWidth,this.canvasHeight),this.last=r.timestamp,r.close(),this.queue.length>0?this.render=self.requestAnimationFrame(this.draw.bind(this)):this.render=0}setSize(e){this.canvasWidth=e.width,this.canvasHeight=e.height}};var z=G(At());var H=class{reader;buffer;constructor(e,i=new Uint8Array(0)){this.reader=e,this.buffer=i}async read(){if(this.buffer.byteLength){let r=this.buffer;return this.buffer=new Uint8Array,r}let e=this.reader.getReader(),i=await e.read();return e.releaseLock(),i.value}async readAll(){let e=this.reader.getReader();for(;;){let r=await e.read();if(r.done)break;let n=new Uint8Array(r.value);if(this.buffer.byteLength==0)this.buffer=n;else{let a=new Uint8Array(this.buffer.byteLength+n.byteLength);a.set(this.buffer),a.set(n,this.buffer.byteLength),this.buffer=a}}let i=this.buffer;return this.buffer=new Uint8Array,e.releaseLock(),i}async bytes(e){let i=this.reader.getReader();for(;this.buffer.byteLength<e;){let n=await i.read();if(n.done)throw"short buffer";let a=new Uint8Array(n.value);if(this.buffer.byteLength==0)this.buffer=a;else{let o=new Uint8Array(this.buffer.byteLength+a.byteLength);o.set(this.buffer),o.set(a,this.buffer.byteLength),this.buffer=o}}let r=new Uint8Array(this.buffer.buffer,this.buffer.byteOffset,e);return this.buffer=new Uint8Array(this.buffer.buffer,this.buffer.byteOffset+e),i.releaseLock(),r}async peek(e){let i=this.reader.getReader();for(;this.buffer.byteLength<e;){let n=await i.read();if(n.done)throw"short buffer";let a=new Uint8Array(n.value);if(this.buffer.byteLength==0)this.buffer=a;else{let o=new Uint8Array(this.buffer.byteLength+a.byteLength);o.set(this.buffer),o.set(a,this.buffer.byteLength),this.buffer=o}}let r=new Uint8Array(this.buffer.buffer,this.buffer.byteOffset,e);return i.releaseLock(),r}async view(e){let i=await this.bytes(e);return new DataView(i.buffer,i.byteOffset,i.byteLength)}async uint8(){return(await this.view(1)).getUint8(0)}async uint16(){return(await this.view(2)).getUint16(0)}async uint32(){return(await this.view(4)).getUint32(0)}async uint52(){let e=await this.uint64();if(e>Number.MAX_SAFE_INTEGER)throw"overflow";return Number(e)}async vint52(){let e=await this.vint64();if(e>Number.MAX_SAFE_INTEGER)throw"overflow";return Number(e)}async uint64(){return(await this.view(8)).getBigUint64(0)}async vint64(){let e=await this.peek(1);switch((new DataView(e.buffer,e.byteOffset,e.byteLength).getUint8(0)&192)>>6){case 0:let n=await this.uint8();return BigInt(n)&0x3fn;case 1:let a=await this.uint16();return BigInt(a)&0x3fffn;case 2:let o=await this.uint32();return BigInt(o)&0x3fffffffn;case 3:return await this.uint64()&0x3fffffffffffffffn;default:throw"impossible"}}async done(){try{let e=await this.peek(1);return!1}catch{return!0}}};var M=class{promise;resolve;reject;constructor(){this.resolve=e=>{},this.reject=e=>{},this.promise=new Promise((e,i)=>{this.resolve=e,this.reject=i})}};var jt=G(Y(),1),qt=G(Y(),1),P=G(Y(),1);var _e={data:""},ye=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||_e;var ge=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,me=/\/\*[^]*?\*\/|  +/g,Ot=/\n+/g,D=(t,e)=>{let i="",r="",n="";for(let a in t){let o=t[a];a[0]=="@"?a[1]=="i"?i=a+" "+o+";":r+=a[1]=="f"?D(o,a):a+"{"+D(o,a[1]=="k"?"":e)+"}":typeof o=="object"?r+=D(o,e?e.replace(/([^,])+/g,h=>a.replace(/(^:.*)|([^,])+/g,f=>/&/.test(f)?f.replace(/&/g,h):h?h+" "+f:f)):a):o!=null&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=D.p?D.p(a,o):a+":"+o+";")}return i+(e&&n?e+"{"+n+"}":n)+r},C={},Gt=t=>{if(typeof t=="object"){let e="";for(let i in t)e+=i+Gt(t[i]);return e}return t},ve=(t,e,i,r,n)=>{let a=Gt(t),o=C[a]||(C[a]=(f=>{let d=0,u=11;for(;d<f.length;)u=101*u+f.charCodeAt(d++)>>>0;return"go"+u})(a));if(!C[o]){let f=a!==t?t:(d=>{let u,y,g=[{}];for(;u=ge.exec(d.replace(me,""));)u[4]?g.shift():u[3]?(y=u[3].replace(Ot," ").trim(),g.unshift(g[0][y]=g[0][y]||{})):g[0][u[1]]=u[2].replace(Ot," ").trim();return g[0]})(t);C[o]=D(n?{["@keyframes "+o]:f}:f,i?"":"."+o)}let h=i&&C.g?C.g:null;return i&&(C.g=C[o]),((f,d,u,y)=>{y?d.data=d.data.replace(y,f):d.data.indexOf(f)===-1&&(d.data=u?f+d.data:d.data+f)})(C[o],e,r,h),o},be=(t,e,i)=>t.reduce((r,n,a)=>{let o=e[a];if(o&&o.call){let h=o(i),f=h&&h.props&&h.props.className||/^go/.test(h)&&h;o=f?"."+f:h&&typeof h=="object"?h.props?"":D(h,""):h===!1?"":h}return r+n+(o??"")},"");function X(t){let e=this||{},i=t.call?t(e.p):t;return ve(i.unshift?i.raw?be(i,[].slice.call(arguments,1),e.p):i.reduce((r,n)=>Object.assign(r,n&&n.call?n(e.p):n),{}):i,ye(e.target),e.g,e.o,e.k)}var Ht,ct,_t,pi=X.bind({g:1}),A=X.bind({k:1});function Vt(t,e,i,r){D.p=e,Ht=t,ct=i,_t=r}function B(t,e){let i=this||{};return function(){let r=arguments;function n(a,o){let h=Object.assign({},a),f=h.className||n.className;i.p=Object.assign({theme:ct&&ct()},h),i.o=/ *go\d+/.test(f),h.className=X.apply(i,r)+(f?" "+f:""),e&&(h.ref=o);let d=t;return t[0]&&(d=h.as||t,delete h.as),_t&&d[0]&&_t(h),Ht(d,h)}return e?e(n):n}}var N=G(Y(),1);var vt=G(Y(),1),xe=t=>typeof t=="function",gt=(t,e)=>xe(t)?t(e):t,Ue=(()=>{let t=0;return()=>(++t).toString()})(),Se=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),we=20,rt=new Map,Ee=1e3,Yt=t=>{if(rt.has(t))return;let e=setTimeout(()=>{rt.delete(t),st({type:4,toastId:t})},Ee);rt.set(t,e)},Ae=t=>{let e=rt.get(t);e&&clearTimeout(e)},mt=(t,e)=>{switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,we)};case 1:return e.toast.id&&Ae(e.toast.id),{...t,toasts:t.toasts.map(a=>a.id===e.toast.id?{...a,...e.toast}:a)};case 2:let{toast:i}=e;return t.toasts.find(a=>a.id===i.id)?mt(t,{type:1,toast:i}):mt(t,{type:0,toast:i});case 3:let{toastId:r}=e;return r?Yt(r):t.toasts.forEach(a=>{Yt(a.id)}),{...t,toasts:t.toasts.map(a=>a.id===r||r===void 0?{...a,visible:!1}:a)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let n=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(a=>({...a,pauseDuration:a.pauseDuration+n}))}}},Be=[],yt={toasts:[],pausedAt:void 0},st=t=>{yt=mt(yt,t),Be.forEach(e=>{e(yt)})},_i={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3};var Ie=(t,e="blank",i)=>({createdAt:Date.now(),visible:!0,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...i,id:i?.id||Ue()}),Z=t=>(e,i)=>{let r=Ie(e,t,i);return st({type:2,toast:r}),r.id},F=(t,e)=>Z("blank")(t,e);F.error=Z("error");F.success=Z("success");F.loading=Z("loading");F.custom=Z("custom");F.dismiss=t=>{st({type:3,toastId:t})};F.remove=t=>st({type:4,toastId:t});F.promise=(t,e,i)=>{let r=F.loading(e.loading,{...i,...i?.loading});return t.then(n=>(F.success(gt(e.success,n),{id:r,...i,...i?.success}),n)).catch(n=>{F.error(gt(e.error,n),{id:r,...i,...i?.error})}),t};var ze=A`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Fe=A`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Te=A`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Ce=B("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${ze} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Fe} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Te} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Pe=A`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Le=B("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${Pe} 1s linear infinite;
`,ke=A`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,De=A`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Re=B("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${ke} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${De} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Me=B("div")`
  position: absolute;
`,Ne=B("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Oe=A`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Ge=B("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Oe} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,He=({toast:t})=>{let{icon:e,type:i,iconTheme:r}=t;return e!==void 0?typeof e=="string"?N.createElement(Ge,null,e):e:i==="blank"?null:N.createElement(Ne,null,N.createElement(Le,{...r}),i!=="loading"&&N.createElement(Me,null,i==="error"?N.createElement(Ce,{...r}):N.createElement(Re,{...r})))},Ve=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Ye=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,je="0%{opacity:0;} 100%{opacity:1;}",qe="0%{opacity:1;} 100%{opacity:0;}",$e=B("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Ke=B("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,We=(t,e)=>{let i=t.includes("top")?1:-1,[r,n]=Se()?[je,qe]:[Ve(i),Ye(i)];return{animation:e?`${A(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${A(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},xi=P.memo(({toast:t,position:e,style:i,children:r})=>{let n=t.height?We(t.position||e||"top-center",t.visible):{opacity:0},a=P.createElement(He,{toast:t}),o=P.createElement(Ke,{...t.ariaProps},gt(t.message,t));return P.createElement($e,{className:t.className,style:{...n,...i,...t.style}},typeof r=="function"?r({icon:a,message:o}):P.createElement(P.Fragment,null,a,o))});Vt(vt.createElement);var Si=X`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`;var J=class{tracks;renderer;constructor(e){this.tracks=new Map,this.renderer=e}async init(e){let i=this.tracks.get(e.track);if(i||(i=new M,this.tracks.set(e.track,i)),e.info.videoTracks.length!=1||e.info.audioTracks.length!=0)throw new Error("Expected a single video track");i.resolve(e)}async decode(e){let i=this.tracks.get(e.track);i||(i=new M,this.tracks.set(e.track,i));let r=await i.promise,a=r.info.videoTracks[0],o=new VideoDecoder({output:u=>{this.renderer.emit(u)},error:u=>{console.warn(u)}}),h=z.createFile();h.onSamples=(u,y,g)=>{for(let _ of g){let b=1e3*_.dts/_.timescale;if(_.is_sync){let U=_.description.avcC,T=new z.DataStream(new Uint8Array(U.size),0,!1);U.write(T),o.configure({codec:a.codec,codedHeight:a.track_height,codedWidth:a.track_width,description:T.buffer?.slice(8)})}o.decode(new EncodedVideoChunk({data:_.data,duration:_.duration,timestamp:b,type:_.is_sync?"key":"delta"}))}},h.onReady=u=>{h.setExtractionOptions(u.tracks[0].id,{},{nbSamples:1}),h.start()};let f=0;for(let u of r.raw)u.fileStart=f,h.appendBuffer(u);let d=new H(e.reader,e.buffer);for(;!await d.done();){let u=await d.peek(4),y=new DataView(u.buffer,u.byteOffset,u.byteLength).getUint32(0),g=await d.bytes(y),_=new Uint8Array(g.byteLength);_.set(g);let b=_.buffer;b.fileStart=f,f=h.appendBuffer(b),h.flush()}}};var bt,xt;self.addEventListener("message",async t=>{if(t.data.config){let e=t.data.config;xt=new K(e),bt=new J(xt)}else if(t.data.init){let e=t.data.init;await bt.init(e)}else if(t.data.segment){let e=t.data.segment;await bt.decode(e)}else if(t.data.size){let e=t.data.size;await xt.setSize(e)}});
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
